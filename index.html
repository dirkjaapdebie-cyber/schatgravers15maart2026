<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schatgravers - Olijfberg Project</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e3799; --accent: #eb4d4b; --success: #20bf6b; --bg: #0a3d62; --gold: #f1c40f; }
        body, html { margin: 0; padding: 0; height: 100vh; font-family: 'Fredoka', sans-serif; overflow: hidden; background: var(--bg); color: #333; }
        
        .bg-fixed {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(10, 61, 98, 0.85), rgba(10, 61, 98, 0.85)), url('schatgravers15maart.jpg');
            background-size: cover; background-position: center; z-index: -1;
        }

        .container { display: none; height: 100vh; padding: 25px; box-sizing: border-box; flex-direction: column; }

        /* FASE 1: NAMEN DISPLAY */
        .names-display-area { 
            background: white; 
            border-radius: 20px; 
            padding: 20px; 
            margin-top: 20px; 
            min-height: 150px; 
            width: 100%; 
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-content: flex-start;
            overflow-y: auto;
        }
        .name-tag { 
            background: var(--gold); 
            color: #333; 
            padding: 8px 18px; 
            border-radius: 25px; 
            font-weight: bold; 
            font-size: 1.1rem;
            box-shadow: 0 4px 0 #d4ac0d;
            animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }

        /* FASE 3: DASHBOARD */
        .f3-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; height: 80vh; }
        .sidebar { background: white; padding: 25px; border-radius: 20px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .stelling-box { background: #f9f9f9; border: 2px dashed var(--primary); padding: 15px; margin: 15px 0; border-radius: 12px; font-weight: 600; text-align: center; color: #444; min-height: 100px; display: flex; align-items: center; justify-content: center; }

        .vault-grid { display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); gap: 12px; }
        .vault { background: rgba(255,255,255,0.95); border-radius: 15px; padding: 12px; border: 4px solid transparent; transition: 0.3s; display: flex; flex-direction: column; }
        .vault.active { border-color: var(--gold); transform: scale(1.02); background: white; }
        .v-title { font-weight: 600; color: var(--primary); border-bottom: 2px solid #eee; margin-bottom: 5px; }
        .v-list { flex: 1; overflow-y: auto; font-size: 0.85rem; }

        /* NAVIGATIE */
        .navigation-panel { position: fixed; bottom: 20px; right: 20px; display: flex; gap: 12px; z-index: 10000; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 30px; }
        .nav-btn { width: 50px; height: 50px; border-radius: 50%; border: 2px solid white; background: transparent; color: white; cursor: pointer; font-weight: bold; font-size: 1.2rem; }
        .nav-btn.active { background: white; color: var(--bg); }

        .btn { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; cursor: pointer; font-family: 'Fredoka'; font-weight: bold; width: 100%; font-size: 1rem; }
        .input-field { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #ddd; font-family: 'Fredoka'; box-sizing: border-box; font-size: 1rem; }
    </style>
</head>
<body>

<audio id="ping-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
<div class="bg-fixed"></div>

<div id="phase-1" class="container" style="display:flex; justify-content:center; align-items:center;">
    <div style="background:rgba(255,255,255,0.9); padding:40px; border-radius:30px; text-align:center; width:600px; box-shadow: 0 20px 60px rgba(0,0,0,0.5);">
        <h1 style="margin:0 0 10px 0; color:var(--primary);">Schatgravers</h1>
        <p style="margin-bottom:20px; color:#555;">Vul je naam in en druk op START</p>
        
        <div style="max-width:350px; margin: 0 auto 30px auto;">
            <input type="text" id="name-in" placeholder="Typ hier je naam..." class="input-field">
            <button onclick="sendName()" class="btn" style="margin-top:15px; background:var(--success);">START</button>
        </div>

        <h3 style="color:var(--primary); margin-bottom:10px;">Wie doen er mee?</h3>
        <div id="display-names-list" class="names-display-area">
            </div>
    </div>
</div>

<div id="phase-2" class="container" style="display:flex; justify-content:center; align-items:center;">
    <div style="background:white; padding:50px; border-radius:30px; text-align:center; box-shadow:0 10px 40px rgba(0,0,0,0.3);">
        <h1 id="timer-p2" style="font-size:6rem; color:var(--accent); margin:0;">01:30</h1>
        <p style="font-size:1.5rem;">Ga op ontdekking op de Olijfberg!</p>
        <a href="https://earth.google.com/web/search/Mount+of+Olives" target="_blank" class="btn" style="text-decoration:none; display:inline-block; margin-top:20px;">GOOGLE EARTH üåç</a>
    </div>
</div>

<div id="phase-3" class="container">
    <div class="f3-layout">
        <div class="sidebar">
            <div style="text-align:center;">
                <div id="dice-display" style="font-size:5rem;">üé≤</div>
                <h2 id="dice-title" style="margin:5px 0; color:var(--primary);">Gooi!</h2>
                <div id="stelling-text" class="stelling-box">Klik op de knop om te beginnen...</div>
                <button onclick="triggerRoll()" class="btn" style="background:var(--gold); color:black;">DOBBELEN</button>
            </div>
            <div style="margin-top:auto;">
                <input type="text" id="thought-in" placeholder="Wat denk jij?..." class="input-field">
                <button onclick="sendThought()" class="btn" style="margin-top:10px; background:var(--success);">VERSTUUR ‚ú®</button>
            </div>
        </div>
        <div class="vault-grid">
            <div class="vault" id="v-1"><div class="v-title">1. ANGST</div><div class="v-list" id="l1"></div></div>
            <div class="vault" id="v-2"><div class="v-title">2. KEUZES</div><div class="v-list" id="l2"></div></div>
            <div class="vault" id="v-3"><div class="v-title">3. ENGELEN</div><div class="v-list" id="l3"></div></div>
            <div class="vault" id="v-4"><div class="v-title">4. BIDDEN</div><div class="v-list" id="l4"></div></div>
            <div class="vault" id="v-5"><div class="v-title">5. ALLEEN</div><div class="v-list" id="l5"></div></div>
            <div class="vault" id="v-6"><div class="v-title">6. HERSTEL</div><div class="v-list" id="l6"></div></div>
        </div>
    </div>
</div>

<div id="phase-4" class="container">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h2 style="color:white; margin:0;">Gebeden Matcher</h2>
        <a href="https://www.online-bijbel.nl/" target="_blank" class="btn" style="width:200px; background:#2980b9; text-decoration:none; text-align:center;">BIJBEL.NL üìñ</a>
    </div>
    <div style="display:flex; flex-wrap:wrap; gap:10px; background:rgba(255,255,255,0.1); padding:15px; border-radius:15px; margin-bottom:15px; justify-content:center;" id="names-source"></div>
    <div style="display:grid; grid-template-columns:repeat(3, 1fr); gap:12px; overflow-y:auto; flex:1; padding-bottom:100px;" id="prayer-targets"></div>
</div>

<div id="phase-5" class="container">
    <div style="text-align:center; color:white;">
        <div id="ws-timer" style="font-size:4rem; font-weight:bold; margin-bottom:20px;">03:00</div>
        <div style="display:flex; justify-content:center; gap:30px;">
            <div id="ws-grid" style="display:grid; grid-template-columns:repeat(15, 34px); gap:5px; background:rgba(255,255,255,0.1); padding:15px; border-radius:15px;"></div>
            <div id="ws-list" style="background:white; color:#333; padding:20px; border-radius:20px; width:250px; height:480px; overflow-y:auto; text-align:left;"></div>
        </div>
    </div>
</div>

<div class="navigation-panel">
    <button class="nav-btn" id="btn-p1" onclick="updatePhase('p1')">1</button>
    <button class="nav-btn" id="btn-p2" onclick="updatePhase('p2')">2</button>
    <button class="nav-btn" id="btn-p3" onclick="updatePhase('p3')">3</button>
    <button class="nav-btn" id="btn-p4" onclick="updatePhase('p4')">4</button>
    <button class="nav-btn" id="btn-p5" onclick="updatePhase('p5')">5</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54",
        authDomain: "schatgravers15maart2026.firebaseapp.com",
        projectId: "schatgravers15maart2026",
        databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app",
        appId: "1:30561512857:web:fcb7868b87d292d1c97708"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let p2Int, wsInt, curDice = 1;

    const stellingen = [
        "Ik ben nooit bang.",
        "Als ik iets heel spannend vind om te gaan doen, hoop ik dat het niet doorgaat.",
        "Als ik zie dat iemand het moeilijk heeft, probeer ik hem of haar te helpen.",
        "Als ik het moeilijk heb of bang ben, ga ik bidden.",
        "Ik heb weleens kracht van God gekregen of gevoeld toen ik het moeilijk had.",
        "Ik zou graag meer willen weten over wat God precies wil."
    ];

    const dobbelIconen = ["‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"];

    // LIVE NAMENLIJST UPDATE
    onValue(ref(db, 'names'), s => {
        const list = document.getElementById('display-names-list');
        list.innerHTML = '';
        if(s.val()) {
            Object.values(s.val()).forEach(name => {
                const tag = document.createElement('div');
                tag.className = 'name-tag';
                tag.innerText = name;
                list.appendChild(tag);
            });
        }
    });

    window.sendName = () => {
        const input = document.getElementById('name-in');
        if(input.value.trim()) {
            push(ref(db, 'names'), input.value.trim());
            input.value = '';
        }
    };

    window.updatePhase = (p) => set(ref(db, 'currentPhase'), p);

    onValue(ref(db, 'currentPhase'), s => {
        const p = s.val() || 'p1';
        document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
        document.getElementById('phase-' + p.replace('p','')).style.display = 'flex';
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+p).classList.add('active');
        if(p==='p2') startP2(); else clearInterval(p2Int);
        if(p==='p4') initP4();
        if(p==='p5') startWS(); else clearInterval(wsInt);
    });

    window.triggerRoll = () => set(ref(db, 'dice'), Math.floor(Math.random()*6)+1);

    onValue(ref(db, 'dice'), s => {
        curDice = s.val() || 1;
        const titels = ["ANGST", "KEUZES", "ENGELEN", "BIDDEN", "ALLEEN", "HERSTEL"];
        document.getElementById('dice-display').innerText = dobbelIconen[curDice-1];
        document.getElementById('dice-title').innerText = titels[curDice-1];
        document.getElementById('stelling-text').innerText = stellingen[curDice-1];
        document.querySelectorAll('.vault').forEach(v => v.classList.remove('active'));
        document.getElementById('v-'+curDice).classList.add('active');
    });

    window.sendThought = () => {
        const v = document.getElementById('thought-in').value;
        if(v) { push(ref(db, 'vaults/'+curDice), v); document.getElementById('thought-in').value=''; }
    };

    onValue(ref(db, 'vaults'), s => {
        for(let i=1; i<=6; i++) {
            const l = document.getElementById('l'+i); l.innerHTML = '';
            if(s.val() && s.val()[i]) Object.values(s.val()[i]).forEach(t => l.innerHTML += `<div style="background:#f0f0f0; margin:4px 0; padding:8px; border-radius:8px; border-left:4px solid var(--primary);">${t}</div>`);
        }
    });

    // --- OVERIGE LOGICA ---
    function initP4() {
        const src = document.getElementById('names-source'); const trg = document.getElementById('prayer-targets');
        src.innerHTML = ''; trg.innerHTML = '';
        const gebeden = [
            {n:"Abraham", g:"In Sodom onschuldigen sparen.", b:"Gen. 18:22"}, {n:"Agur", g:"Precies wat ik nodig heb.", b:"Spr. 30:7"},
            {n:"David", g:"Bid om vergeving.", b:"Ps. 51:3"}, {n:"Elia", g:"Vraag om Gods antwoord.", b:"1 Kon. 18:37"},
            {n:"Gideon", g:"Vraag om een teken.", b:"Rech. 6:36"}, {n:"Hanna", g:"Bid om een zoon.", b:"1 Sam. 1:9"},
            {n:"Jesaja", g:"Kijk uit de hemel naar ons.", b:"Jes. 63:15"}, {n:"Jezus", g:"Voor alle gelovigen.", b:"Joh. 17:20"},
            {n:"Jezus", g:"Uw wil geschiede.", b:"Luc. 22:42"}, {n:"Jezus", g:"Vader, vergeef hen.", b:"Luc. 23:34"}
        ];
        gebeden.sort(() => Math.random() - 0.5).forEach((k, i) => {
            const d = document.createElement('div'); d.className = 'name-tag'; d.style.cursor = 'grab'; d.innerText = k.n; d.draggable = true;
            d.id = 'd-'+i; d.ondragstart = (e) => e.dataTransfer.setData('text', e.target.id);
            src.appendChild(d);
        });
        gebeden.forEach((k) => {
            const z = document.createElement('div'); z.style = "background:white; padding:15px; border-radius:15px; min-height:100px; border:2px dashed #ccc;";
            z.innerHTML = `<i>"${k.g}"</i><br><small><b>${k.b}</b></small>`;
            z.ondragover = (e) => e.preventDefault();
            z.ondrop = (e) => {
                e.preventDefault(); const id = e.dataTransfer.getData('text');
                z.innerHTML = `<span style="background:var(--primary);color:white;padding:2px 8px;border-radius:5px;">${document.getElementById(id).innerText}</span><br><i>"${k.g}"</i>`;
                z.style.border = '2px solid var(--success)';
            };
            trg.appendChild(z);
        });
    }

    function startWS() {
        const g = document.getElementById('ws-grid'); const l = document.getElementById('ws-list');
        g.innerHTML = ''; l.innerHTML = '';
        const woorden = ["OLIJFBERG", "JUDAS", "VERRAAD", "BEKER", "SLAPEN", "ENGEL", "KRACHT", "GEBED", "SOLDATEN", "KUS", "PETRUS", "HAAN"];
        for(let i=0; i<225; i++) {
            const c = document.createElement('div'); c.style = "width:34px; height:34px; background:white; display:flex; align-items:center; justify-content:center; font-weight:bold; cursor:pointer; border-radius:5px;";
            c.innerText = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)];
            c.onclick = () => c.style.background = (c.style.background === 'rgb(241, 196, 15)') ? 'white' : 'rgb(241, 196, 15)';
            g.appendChild(c);
        }
        woorden.forEach(w => {
            const i = document.createElement('div'); i.innerText = w; i.style.padding = "5px 0"; i.style.cursor = "pointer";
            i.onclick = () => i.style.textDecoration = (i.style.textDecoration === 'line-through') ? 'none' : 'line-through';
            l.appendChild(i);
        });
        let t = 180;
        wsInt = setInterval(() => {
            let m=Math.floor(t/60), s=t%60;
            document.getElementById('ws-timer').innerText = `${m}:${s.toString().padStart(2,'0')}`;
            if(t-- <= 0) { clearInterval(wsInt); document.getElementById('ping-sound').play(); }
        }, 1000);
    }

    function startP2() {
        let t = 90;
        p2Int = setInterval(() => {
            let m=Math.floor(t/60), s=t%60;
            document.getElementById('timer-p2').innerText = `${m}:${s.toString().padStart(2,'0')}`;
            if(t-- <= 0) { clearInterval(p2Int); document.getElementById('ping-sound').play(); }
        }, 1000);
    }
</script>
</body>
</html>
