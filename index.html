<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Schatgravers - Met Leaderboard</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54&callback=initMap" async defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Fredoka', sans-serif; background: #0a3d62; min-height: 100vh; display: flex; justify-content: center; padding: 10px; }
        
        /* Main container */
        #app { width: 100%; max-width: 450px; position: relative; }
        
        /* Screens */
        .screen { display: none; background: white; border-radius: 30px; padding: 20px; min-height: 80vh; box-shadow: 0 20px 40px rgba(0,0,0,0.4); animation: fadeIn 0.5s; margin-bottom: 20px; }
        .screen.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Admin bar */
        #admin-bar { background: #1e3799; color: white; padding: 15px; border-radius: 50px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); flex-wrap: wrap; gap: 10px; }
        #admin-bar button { background: #f6b93b; border: none; padding: 10px 20px; border-radius: 30px; font-weight: bold; color: #1e3799; font-size: 1rem; cursor: pointer; box-shadow: 0 3px 0 #b86d0c; }
        #screen-indicator { background: rgba(255,255,255,0.2); padding: 8px 20px; border-radius: 30px; font-weight: bold; }
        #reset-btn { background: #e55039 !important; color: white !important; box-shadow: 0 3px 0 #b71540 !important; }
        
        /* Common styles */
        h2 { color: #1e3799; margin-bottom: 20px; font-size: 1.8rem; text-align: center; }
        h3 { color: #0a3d62; margin: 15px 0 10px; }
        input, textarea { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 15px; font-family: 'Fredoka', sans-serif; }
        .btn { background: #1e3799; color: white; border: none; padding: 15px 25px; border-radius: 50px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.2rem; margin: 10px 0; }
        .timer { background: #f6b93b; color: #1e3799; padding: 10px; border-radius: 30px; text-align: center; font-weight: bold; margin: 10px 0; font-size: 1.3rem; }
        
        /* Live feed */
        .live-feed { background: #f1f2f6; padding: 15px; border-radius: 20px; margin-top: 20px; max-height: 300px; overflow-y: auto; }
        .name-tag { background: white; padding: 10px; margin: 5px 0; border-radius: 10px; border-left: 5px solid #20bf6b; animation: slideIn 0.3s; display: flex; justify-content: space-between; }
        .time-badge { background: #1e3799; color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.8rem; }
        
        /* Map */
        #map { height: 400px; border-radius: 20px; margin: 15px 0; }
        
        /* Rad van Fortuin */
        .wheel-container { position: relative; width: 300px; height: 300px; margin: 20px auto; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#f6b93b 0deg 60deg, #1e3799 60deg 120deg, #20bf6b 120deg 180deg, #e55039 180deg 240deg, #fa983a 240deg 300deg, #b71540 300deg 360deg); transition: transform 3s cubic-bezier(0.25, 0.1, 0.15, 1); border: 5px solid #333; }
        #wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 40px; color: #333; z-index: 10; }
        #wheel-number { text-align: center; font-size: 2rem; margin: 10px; color: #1e3799; }
        
        /* Stelling cards */
        .stelling-card { background: #f8f9fa; padding: 15px; border-radius: 15px; margin: 15px 0; border: 2px solid #1e3799; }
        .antwoorden-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 10px; }
        .antwoord-item { background: white; padding: 8px; border-radius: 8px; border-left: 3px solid #20bf6b; font-size: 0.9rem; }
        
        /* Drag & Drop */
        .drag-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .bijbel-figuren, .gebeden { background: #f1f2f6; padding: 15px; border-radius: 15px; max-height: 500px; overflow-y: auto; }
        .figuur-card { background: white; padding: 10px; margin: 8px 0; border-radius: 10px; border: 2px solid #1e3799; cursor: grab; text-align: center; font-weight: bold; }
        .gebed-card { background: #e3f2fd; padding: 10px; margin: 8px 0; border-radius: 10px; border: 2px dashed #1e3799; min-height: 80px; }
        .matched { background: #c8e6c9; border: 2px solid #20bf6b; }
        
        /* Woordveld */
        .woordveld-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .letter-card { background: #1e3799; color: white; font-size: 2rem; font-weight: bold; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .letter-card.selected { background: #f6b93b; color: #1e3799; transform: scale(0.95); }
        .woord-oplossing { font-size: 2rem; letter-spacing: 10px; text-align: center; margin: 20px 0; font-weight: bold; color: #1e3799; }
        
        /* Doolhof */
        #maze-canvas { width: 100%; height: 450px; border-radius: 20px; background: #2d5a27; display: block; margin: 10px 0; border: 3px solid #8B4513; }
        .controls { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .control-btn { background: #1e3799; color: white; border: none; width: 60px; height: 60px; border-radius: 30px; font-size: 2rem; cursor: pointer; }
        
        /* Leaderboard */
        .leaderboard { background: linear-gradient(135deg, #f6b93b, #1e3799); padding: 20px; border-radius: 20px; color: white; }
        .leaderboard-item { background: rgba(255,255,255,0.2); padding: 15px; margin: 10px 0; border-radius: 15px; display: flex; justify-content: space-between; font-size: 1.2rem; }
        .rank-1 { background: gold; color: #1e3799; font-weight: bold; }
        .rank-2 { background: silver; color: #1e3799; }
        .rank-3 { background: #cd7f32; color: white; }
        
        /* Scrollbaar bijbelverhaal */
        .bijbelverhaal { background: #f8f9fa; padding: 20px; border-radius: 20px; max-height: 500px; overflow-y: auto; margin-top: 10px; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
        .bijbeltekst { background: white; padding: 20px; border-radius: 15px; line-height: 1.6; font-size: 1.1rem; }
    </style>
</head>
<body>
<div id="app">
    <!-- Admin Bar - Alleen zichtbaar voor beheerder -->
    <div id="admin-bar">
        <span id="screen-indicator">Scherm 1/7</span>
        <div style="display: flex; gap: 10px;">
            <button id="reset-btn"><i class="fas fa-redo-alt"></i> Reset</button>
            <button id="next-screen-btn"><i class="fas fa-arrow-right"></i> Volgende</button>
        </div>
    </div>

    <!-- Scherm 1: Login + Live Feed met tijden -->
    <div id="screen1" class="screen active">
        <h2>üëã Welkom Schatgravers!</h2>
        <input type="text" id="name-input" placeholder="Jouw naam...">
        <button onclick="saveUser()" class="btn"><i class="fas fa-sign-in-alt"></i> Start!</button>
        
        <div class="live-feed">
            <h3>üì± Live feed - wie doet er mee?</h3>
            <div id="name-list"></div>
        </div>
        <p style="text-align: center; color: #666; margin-top: 10px;"><i>‚è±Ô∏è De tijd loopt zodra je je naam invult!</i></p>
    </div>

    <!-- Scherm 2: Google Maps - Olijfberg -->
    <div id="screen2" class="screen">
        <h2>üèîÔ∏è De Olijfberg</h2>
        <div id="map"></div>
        <p style="margin-top: 15px; background: #f8f9fa; padding: 15px; border-radius: 15px;">üìç Dit is de plek waar Jezus vaak bad met zijn discipelen.</p>
    </div>

    <!-- Scherm 3: Bijbelverhaal (scrollbaar) -->
    <div id="screen3" class="screen">
        <h2>üìñ Jezus bidt op de Olijfberg</h2>
        <div class="bijbelverhaal">
            <div class="bijbeltekst">
                <p><strong style="color: #1e3799;">Jezus bidt op de Olijfberg</strong></p>
                <p>Jezus ging de stad uit. Hij ging naar de Olijfberg, zoals altijd. De leerlingen gingen met hem mee. Toen ze op de berg waren, zei Jezus: 'Bid God om kracht, zodat je geen verkeerde keuze maakt.' Daarna liep hij zelf een stukje verder. Hij knielde en begon te bidden: 'Vader, als u het wilt, houd dan dit zware lijden bij mij weg! Maar doe wat u zelf wilt, niet wat ik wil.' Toen kwam er een engel uit de hemel om Jezus kracht te geven. Jezus was bang en ging steeds harder bidden. Zijn zweet viel in grote druppels op de grond. Het leken wel druppels bloed.</p>
                
                <p>Toen Jezus klaar was met bidden, stond Hij op en ging naar zijn leerlingen. Die waren van verdriet in slaap gevallen. Jezus zei: 'Waarom slapen jullie? Bid God om kracht, zodat je geen verkeerde keuze maakt.'</p>
                
                <p><strong style="color: #e74c3c;">Judas verraadt Jezus</strong></p>
                <p>Terwijl Jezus dat zei, kwam er een groep mannen aan. Judas, √©√©n van de twaalf leerlingen, liep voorop. Hij ging naar Jezus toe en groette hem met een kus. Maar Jezus zei: 'Judas, verraad je de Mensenzoon met een kus?'</p>
                
                <p>Toen de leerlingen begrepen wat er ging gebeuren, vroegen ze: 'Heer, zullen we onze zwaarden pakken?' En √©√©n van de leerlingen pakte zijn zwaard en sloeg de knecht van de hogepriester. Hij sloeg zijn rechteroor eraf. Maar Jezus zei: 'Stop, genoeg!' En hij pakte het oor en maakte de man weer beter.</p>
                
                <p>Er waren priesters, officieren van de tempel en leiders van het volk meegekomen om Jezus gevangen te nemen. Jezus zei tegen hen: 'Jullie zijn hier gekomen met zwaarden en stokken. Alsof ik een gevaarlijke misdadiger ben! Elke dag was ik bij jullie in de tempel, maar toen namen jullie mij niet gevangen. Nu is het moment gekomen waarop jullie gewacht hebben. Nu laat de duisternis haar macht zien.'</p>
                
                <p style="font-style: italic; color: #666; margin-top: 15px;">(Lucas 22:39-53)</p>
            </div>
        </div>
        
        <div style="background: #fff3cd; border-left: 5px solid #ffc107; padding: 15px; border-radius: 10px; margin-top: 15px;">
            <p style="margin: 0;"><strong>üí≠ Om over na te denken:</strong><br>Jezus zei: "Doe wat U zelf wilt, niet wat ik wil." Vind jij het moeilijk om te doen wat God wil, of juist niet?</p>
        </div>
    </div>

    <!-- Scherm 4: Rad van Fortuin + 6 Stellingen -->
    <div id="screen4" class="screen">
        <h2>üé° Rad van Fortuin</h2>
        <div class="wheel-container">
            <div id="wheel"></div>
            <div id="wheel-pointer">‚ñº</div>
        </div>
        <div id="wheel-number">Klik op de knop om te draaien!</div>
        <button onclick="spinWheel()" class="btn" style="background: #f6b93b; color: #1e3799;">üé≤ Draai aan het rad!</button>
        
        <div id="stellingen-container" style="display: none; margin-top: 30px;">
            <h3>üìù Stellingen - schrijf jouw idee op!</h3>
            <div id="stellingen-lijst"></div>
        </div>
        
        <div id="antwoorden-overzicht" style="margin-top: 30px; display: none;">
            <h3>üëÄ Wat vinden de anderen?</h3>
            <div id="antwoorden-grid"></div>
        </div>
    </div>

    <!-- Scherm 5: Drag & Drop Gebeden met timer -->
    <div id="screen5" class="screen">
        <h2>üôè Bij welk gebed hoort wie?</h2>
        <div class="timer" id="drag-timer">‚è±Ô∏è Tijd: 0:00</div>
        <p style="text-align: center; margin-bottom: 15px;">Sleep de bijbelfiguur naar het juiste gebed</p>
        <div class="drag-container" id="drag-drop-area"></div>
        <button onclick="checkMatches()" class="btn" style="background: #20bf6b;">‚úÖ Klaar! Stop de tijd</button>
        <div id="match-result" style="text-align: center; margin-top: 15px; font-weight: bold;"></div>
    </div>

    <!-- Scherm 6: Woordveld "God is machtig" -->
    <div id="screen6" class="screen">
        <h2>üî§ Woordveld</h2>
        <p style="text-align: center;">Vorm de woorden: <strong>"GOD IS MACHTIG"</strong></p>
        <div class="timer" id="woord-timer">‚è±Ô∏è Tijd: 0:00</div>
        
        <div class="woord-oplossing" id="woord-oplossing">_ _ _   _ _   _ _ _ _ _ _</div>
        
        <div class="woordveld-grid" id="woordveld-grid">
            <!-- Letters worden hier ingeladen met JS -->
        </div>
        
        <button onclick="checkWoord()" class="btn" style="background: #20bf6b;">‚úÖ Controleer</button>
        <button onclick="resetWoord()" class="btn" style="background: #e55039;">üîÑ Opnieuw</button>
        <div id="woord-result" style="text-align: center; margin-top: 15px; font-weight: bold;"></div>
    </div>

    <!-- Scherm 7: Doolhof + Leaderboard -->
    <div id="screen7" class="screen">
        <h2>üèÉ Discipelen naar Jezus</h2>
        <div class="timer" id="maze-timer">‚è±Ô∏è Tijd: 0:00</div>
        <canvas id="maze-canvas" width="400" height="400"></canvas>
        <div class="controls">
            <button class="control-btn" onclick="moveDisciple('up')">‚Üë</button>
            <button class="control-btn" onclick="moveDisciple('left')">‚Üê</button>
            <button class="control-btn" onclick="moveDisciple('down')">‚Üì</button>
            <button class="control-btn" onclick="moveDisciple('right')">‚Üí</button>
        </div>
        <button onclick="finishMaze()" class="btn" style="background: #20bf6b;">üèÅ Jezus bereikt!</button>
        <p style="text-align: center; margin: 10px 0; color: #666;">üö´ Pas op voor de wachters (rood)!</p>
        
        <!-- Leaderboard -->
        <div class="leaderboard">
            <h3 style="color: white; text-align: center;">üèÜ Snelste Schatgravers üèÜ</h3>
            <div id="leaderboard-list"></div>
        </div>
    </div>
</div>

<script type="module">
    // 1. Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, set, remove, query, orderByChild, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // 2. Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54",
        authDomain: "schatgravers15maart2026.firebaseapp.com",
        databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "schatgravers15maart2026",
        appId: "1:30561512857:web:fcb7868b87d292d1c97708"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 3. Globale variabelen
    let currentScreen = 1;
    let currentStelling = 0;
    let currentUser = null;
    let startTime = null;
    let dragStartTime = null;
    let woordStartTime = null;
    let mazeStartTime = null;
    let dragTimerInterval = null;
    let woordTimerInterval = null;
    let mazeTimerInterval = null;
    
    const stellingen = [
        "Ik ben nooit bang.",
        "Als ik iets heel spannend vind om te gaan doen, hoop ik dat het niet doorgaat.",
        "Als ik zie dat iemand het moeilijk heeft, probeer ik hem of haar te helpen.",
        "Als ik het moeilijk heb of bang ben, ga ik bidden.",
        "Ik heb weleens kracht van God gekregen of de kracht van God gevoeld toen ik het moeilijk had.",
        "Ik zou graag meer willen weten over wat God precies wil."
    ];

    // 4. Login functie met starttijd
    window.saveUser = () => {
        const name = document.getElementById('name-input').value.trim();
        if(name) {
            currentUser = name;
            startTime = Date.now();
            localStorage.setItem('mijnNaam', name);
            
            // Sla gebruiker op met starttijd
            push(ref(db, 'users'), { 
                name: name, 
                startTime: startTime,
                timestamp: Date.now() 
            });
            
            document.getElementById('name-input').value = "";
        }
    };

    // 5. Live feed met tijden
    const nameList = document.getElementById('name-list');
    onValue(ref(db, 'users'), (snapshot) => {
        nameList.innerHTML = "";
        if(snapshot.exists()) {
            const users = snapshot.val();
            Object.values(users).reverse().forEach(user => {
                const div = document.createElement('div');
                div.className = 'name-tag';
                const tijdBezig = user.startTime ? Math.round((Date.now() - user.startTime) / 1000) + 's' : '0s';
                div.innerHTML = `üëã <b>${user.name}</b> <span class="time-badge">‚è±Ô∏è ${tijdBezig}</span>`;
                nameList.appendChild(div);
            });
        }
    });

    // 6. Reset functie
    window.resetAllData = () => {
        if(confirm('‚ö†Ô∏è Weet je zeker dat je ALLES wilt resetten? Alle namen, tijden en antwoorden worden gewist!')) {
            remove(ref(db, 'users'));
            remove(ref(db, 'antwoorden'));
            remove(ref(db, 'leaderboard'));
            remove(ref(db, 'currentScreen'));
            
            currentScreen = 1;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen1').classList.add('active');
            document.getElementById('screen-indicator').textContent = 'Scherm 1/7';
            
            localStorage.clear();
            document.getElementById('name-input').value = '';
            
            // Reset alle timers
            stopAllTimers();
            
            alert('Alles is gereset!');
        }
    };

    // 7. Timer functies
    function stopAllTimers() {
        if(dragTimerInterval) clearInterval(dragTimerInterval);
        if(woordTimerInterval) clearInterval(woordTimerInterval);
        if(mazeTimerInterval) clearInterval(mazeTimerInterval);
    }

    function formatTime(ms) {
        const seconds = Math.floor(ms / 1000);
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    // 8. Scherm navigatie
    document.getElementById('next-screen-btn').addEventListener('click', () => {
        currentScreen = currentScreen < 7 ? currentScreen + 1 : 1;
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(`screen${currentScreen}`).classList.add('active');
        document.getElementById('screen-indicator').textContent = `Scherm ${currentScreen}/7`;
        
        // Start timers voor specifieke schermen
        if(currentScreen === 5) startDragTimer();
        if(currentScreen === 6) startWoordTimer();
        if(currentScreen === 7) startMazeTimer();
        
        set(ref(db, 'currentScreen'), currentScreen);
    });

    // 9. Luister naar schermwijzigingen
    onValue(ref(db, 'currentScreen'), (snapshot) => {
        if(snapshot.exists() && snapshot.val() !== currentScreen) {
            currentScreen = snapshot.val();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen${currentScreen}`).classList.add('active');
        }
    });

    // 10. Google Maps
    window.initMap = function() {
        const olijfberg = { lat: 31.7778, lng: 35.2456 };
        const map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: olijfberg,
            mapTypeId: 'satellite'
        });
        new google.maps.Marker({ position: olijfberg, map: map, title: 'Olijfberg' });
    };

    // 11. Rad van Fortuin
    window.spinWheel = () => {
        const wheel = document.getElementById('wheel');
        const spin = Math.floor(Math.random() * 360) + 720;
        wheel.style.transform = `rotate(${spin}deg)`;
        
        setTimeout(() => {
            const degrees = spin % 360;
            const segment = Math.floor(degrees / 60) + 1;
            currentStelling = segment;
            document.getElementById('wheel-number').textContent = `Stelling ${segment}: ${stellingen[segment-1]}`;
            
            document.getElementById('stellingen-container').style.display = 'block';
            document.getElementById('antwoorden-overzicht').style.display = 'block';
            
            loadStellingen();
        }, 3000);
    };

    // 12. Stellingen
    function loadStellingen() {
        const container = document.getElementById('stellingen-lijst');
        container.innerHTML = '';
        
        stellingen.forEach((stelling, index) => {
            const card = document.createElement('div');
            card.className = 'stelling-card';
            card.innerHTML = `
                <strong>Stelling ${index+1}:</strong> ${stelling}
                <textarea id="antwoord-${index+1}" placeholder="Jouw gedachten..." rows="2"></textarea>
                <button onclick="saveAnswer(${index+1})" class="btn" style="padding: 10px;">üíæ Opslaan</button>
            `;
            container.appendChild(card);
        });
        
        loadAnswers();
    }

    window.saveAnswer = (stellingNr) => {
        const naam = currentUser || localStorage.getItem('mijnNaam') || 'Anoniem';
        const antwoord = document.getElementById(`antwoord-${stellingNr}`).value.trim();
        if(antwoord) {
            push(ref(db, `antwoorden/stelling${stellingNr}`), { 
                naam: naam, 
                antwoord: antwoord,
                timestamp: Date.now()
            });
            document.getElementById(`antwoord-${stellingNr}`).value = '';
        }
    };

    function loadAnswers() {
        const grid = document.getElementById('antwoorden-grid');
        grid.innerHTML = '';
        
        for(let i = 1; i <= 6; i++) {
            const stellingDiv = document.createElement('div');
            stellingDiv.innerHTML = `<h4>Stelling ${i}</h4>`;
            const antwoordenDiv = document.createElement('div');
            antwoordenDiv.className = 'antwoorden-grid';
            antwoordenDiv.id = `antwoorden-stelling${i}`;
            stellingDiv.appendChild(antwoordenDiv);
            grid.appendChild(stellingDiv);
            
            onValue(ref(db, `antwoorden/stelling${i}`), (snapshot) => {
                const container = document.getElementById(`antwoorden-stelling${i}`);
                if(container) {
                    container.innerHTML = '';
                    if(snapshot.exists()) {
                        Object.values(snapshot.val()).reverse().forEach(item => {
                            const div = document.createElement('div');
                            div.className = 'antwoord-item';
                            div.innerHTML = `<b>${item.naam}:</b> ${item.antwoord}`;
                            container.appendChild(div);
                        });
                    }
                }
            });
        }
    }

    // 13. Drag & Drop met timer
    function startDragTimer() {
        dragStartTime = Date.now();
        if(dragTimerInterval) clearInterval(dragTimerInterval);
        dragTimerInterval = setInterval(() => {
            if(dragStartTime) {
                const elapsed = Date.now() - dragStartTime;
                document.getElementById('drag-timer').textContent = `‚è±Ô∏è Tijd: ${formatTime(elapsed)}`;
            }
        }, 100);
    }

    const gebedenMatch = [
        { figuur: "Abraham", gebed: "Ik bid dat er geen onschuldige mensen in de stad Sodom gedood zullen worden." },
        { figuur: "Agur", gebed: "Ik bid om altijd eerlijk te zijn en om precies te krijgen wat ik nodig heb, niet meer en niet minder." },
        { figuur: "David", gebed: "Ik bid om vergeving omdat ik iemand vermoord heb." },
        { figuur: "Elia", gebed: "Ik bid dat God mij antwoord geeft." },
        { figuur: "Gideon", gebed: "Ik vraag God om een teken zodat ik weet dat het waar is wat God heeft gezegd." },
        { figuur: "Hanna", gebed: "Ik bid om een zoon." },
        { figuur: "Jesaja", gebed: "Ik bid dat God vanuit de hemel naar ons kijkt." },
        { figuur: "Jezus", gebed: "Ik bid voor alle mensen die in mij zullen geloven als ze de boodschap van God horen." },
        { figuur: "Jezus", gebed: "Doe wat U zelf wilt, niet wat ik wil" },
        { figuur: "Jezus", gebed: "Vader, vergeef de mensen die mij doden, want ze weten niet wat ze doen" },
        { figuur: "Job", gebed: "Ik bid dat God aan mij denkt, want ik zal nooit meer gelukkig zijn." },
        { figuur: "Mozes", gebed: "Ik probeer God op andere gedachten te brengen." },
        { figuur: "Nehemia", gebed: "Ik doe in stilte een schietgebedje om hulp." },
        { figuur: "Paulus", gebed: "Ik vraag aan anderen om voor mij te bidden." },
        { figuur: "Salomo", gebed: "Ik bid om het verschil tussen goed en kwaad te zien." }
    ];

    window.initDragDrop = () => {
        const container = document.getElementById('drag-drop-area');
        container.innerHTML = `
            <div class="bijbel-figuren" id="figuren-container"></div>
            <div class="gebeden" id="gebeden-container"></div>
        `;
        
        const figurenContainer = document.getElementById('figuren-container');
        const gebedenContainer = document.getElementById('gebeden-container');
        
        const figuren = [...new Set(gebedenMatch.map(g => g.figuur))];
        figuren.forEach(figuur => {
            const div = document.createElement('div');
            div.className = 'figuur-card';
            div.draggable = true;
            div.textContent = figuur;
            div.id = `fig-${figuur}`;
            div.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', figuur);
            });
            figurenContainer.appendChild(div);
        });
        
        gebedenMatch.sort(() => Math.random() - 0.5).forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'gebed-card';
            div.innerHTML = `<small>${item.gebed}</small><br><span id="match-${index}" style="color: #1e3799; font-weight: bold;"></span>`;
            div.addEventListener('dragover', (e) => e.preventDefault());
            div.addEventListener('drop', (e) => {
                e.preventDefault();
                const figuur = e.dataTransfer.getData('text/plain');
                if(figuur === item.figuur) {
                    document.getElementById(`match-${index}`).innerHTML = `‚úì ${figuur}`;
                    div.classList.add('matched');
                } else {
                    alert('‚ùå Dat is niet de juiste figuur!');
                }
            });
            gebedenContainer.appendChild(div);
        });
    };

    window.checkMatches = () => {
        const matches = document.querySelectorAll('.matched').length;
        if(matches === gebedenMatch.length && currentUser) {
            const tijd = Date.now() - dragStartTime;
            document.getElementById('match-result').innerHTML = `üéâ Geweldig! Tijd: ${formatTime(tijd)}`;
            if(dragTimerInterval) clearInterval(dragTimerInterval);
            
            // Sla tijd op in leaderboard
            push(ref(db, 'leaderboard/drag'), {
                naam: currentUser,
                tijd: tijd,
                formattedTime: formatTime(tijd)
            });
        } else {
            document.getElementById('match-result').innerHTML = `Je hebt ${matches} van de ${gebedenMatch.length} goed.`;
        }
    };

    // 14. Woordveld "GOD IS MACHTIG"
    function startWoordTimer() {
        woordStartTime = Date.now();
        if(woordTimerInterval) clearInterval(woordTimerInterval);
        woordTimerInterval = setInterval(() => {
            if(woordStartTime) {
                const elapsed = Date.now() - woordStartTime;
                document.getElementById('woord-timer').textContent = `‚è±Ô∏è Tijd: ${formatTime(elapsed)}`;
            }
        }, 100);
    }

    const oplossing = "GOD IS MACHTIG";
    const letters = ["G","O","D","I","S","M","A","C","H","T","I","G"," ", " ", " "];
    
    window.initWoordveld = () => {
        const grid = document.getElementById('woordveld-grid');
        grid.innerHTML = '';
        const shuffled = [...letters].sort(() => Math.random() - 0.5);
        
        shuffled.forEach((letter, index) => {
            if(letter.trim()) {
                const div = document.createElement('div');
                div.className = 'letter-card';
                div.textContent = letter;
                div.onclick = () => selectLetter(div, letter);
                grid.appendChild(div);
            }
        });
    };

    let selectedLetters = [];
    function selectLetter(element, letter) {
        if(element.classList.contains('selected')) {
            element.classList.remove('selected');
            selectedLetters = selectedLetters.filter(l => l !== letter);
        } else {
            element.classList.add('selected');
            selectedLetters.push(letter);
        }
        updateOplossing();
    }

    function updateOplossing() {
        const display = document.getElementById('woord-oplossing');
        let tekst = '';
        for(let i = 0; i < oplossing.length; i++) {
            if(oplossing[i] === ' ') {
                tekst += '  ';
            } else if(selectedLetters.includes(oplossing[i])) {
                tekst += oplossing[i];
            } else {
                tekst += '_';
            }
        }
        display.textContent = tekst;
    }

    window.checkWoord = () => {
        const current = document.getElementById('woord-oplossing').textContent.replace(/ /g, '');
        const correct = oplossing.replace(/ /g, '');
        
        if(current === correct && currentUser) {
            const tijd = Date.now() - woordStartTime;
            document.getElementById('woord-result').innerHTML = `üéâ Correct! Tijd: ${formatTime(tijd)}`;
            if(woordTimerInterval) clearInterval(woordTimerInterval);
            
            push(ref(db, 'leaderboard/woord'), {
                naam: currentUser,
                tijd: tijd,
                formattedTime: formatTime(tijd)
            });
        } else {
            document.getElementById('woord-result').innerHTML = '‚ùå Nog niet goed, probeer opnieuw!';
        }
    };

    window.resetWoord = () => {
        selectedLetters = [];
        document.querySelectorAll('.letter-card').forEach(c => c.classList.remove('selected'));
        document.getElementById('woord-oplossing').textContent = '_ _ _   _ _   _ _ _ _ _ _';
        document.getElementById('woord-result').innerHTML = '';
    };

    // 15. Doolhof met timer
    function startMazeTimer() {
        mazeStartTime = Date.now();
        if(mazeTimerInterval) clearInterval(mazeTimerInterval);
        mazeTimerInterval = setInterval(() => {
            if(mazeStartTime) {
                const elapsed = Date.now() - mazeStartTime;
                document.getElementById('maze-timer').textContent = `‚è±Ô∏è Tijd: ${formatTime(elapsed)}`;
            }
        }, 100);
    }

    let maze = {
        disciple: { x: 0, y: 0 },
        jesus: { x: 9, y: 9 },
        guards: [{x: 3, y: 3}, {x: 5, y: 5}, {x: 7, y: 2}, {x: 2, y: 7}],
        bushes: [{x: 1, y: 1}, {x: 2, y: 4}, {x: 6, y: 7}, {x: 8, y: 3}, {x: 4, y: 4}]
    };

    function drawMaze() {
        const canvas = document.getElementById('maze-canvas');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        const cellSize = 40;
        
        ctx.clearRect(0, 0, 400, 400);
        
        // Teken grid
        ctx.strokeStyle = '#666';
        for(let i = 0; i <= 10; i++) {
            ctx.beginPath();
            ctx.moveTo(i * cellSize, 0);
            ctx.lineTo(i * cellSize, 400);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, i * cellSize);
            ctx.lineTo(400, i * cellSize);
            ctx.stroke();
        }
        
        // Teken struiken
        maze.bushes.forEach(b => {
            ctx.fillStyle = '#2ecc71';
            ctx.beginPath();
            ctx.arc(b.x * cellSize + cellSize/2, b.y * cellSize + cellSize/2, 15, 0, 2*Math.PI);
            ctx.fill();
            ctx.fillStyle = '#27ae60';
            ctx.font = '12px Fredoka';
            ctx.fillText('üåø', b.x * cellSize + 15, b.y * cellSize + 25);
        });
        
        // Teken wachters
        maze.guards.forEach(g => {
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(g.x * cellSize + 5, g.y * cellSize + 5, 30, 30);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 16px Fredoka';
            ctx.fillText('üëÆ', g.x * cellSize + 12, g.y * cellSize + 28);
        });
        
        // Teken discipel
        ctx.fillStyle = '#3498db';
        ctx.beginPath();
        ctx.arc(maze.disciple.x * cellSize + cellSize/2, maze.disciple.y * cellSize + cellSize/2, 15, 0, 2*Math.PI);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.font = 'bold 16px Fredoka';
        ctx.fillText('üë§', maze.disciple.x * cellSize + 15, maze.disciple.y * cellSize + 28);
        
        // Teken Jezus
        ctx.fillStyle = '#f1c40f';
        ctx.beginPath();
        ctx.arc(maze.jesus.x * cellSize + cellSize/2, maze.jesus.y * cellSize + cellSize/2, 15, 0, 2*Math.PI);
        ctx.fill();
        ctx.fillStyle = '#000';
        ctx.font = 'bold 16px Fredoka';
        ctx.fillText('‚úùÔ∏è', maze.jesus.x * cellSize + 12, maze.jesus.y * cellSize + 28);
    }

    window.moveDisciple = (direction) => {
        const newPos = { ...maze.disciple };
        
        switch(direction) {
            case 'up': if(newPos.y > 0) newPos.y--; break;
            case 'down': if(newPos.y < 9) newPos.y++; break;
            case 'left': if(newPos.x > 0) newPos.x--; break;
            case 'right': if(newPos.x < 9) newPos.x++; break;
        }
        
        const hitGuard = maze.guards.some(g => g.x === newPos.x && g.y === newPos.y);
        if(hitGuard) {
            alert('üëÆ Wachter! Opnieuw!');
            resetMaze();
            return;
        }
        
        maze.disciple = newPos;
        drawMaze();
    };

    window.finishMaze = () => {
        if(maze.disciple.x === maze.jesus.x && maze.disciple.y === maze.jesus.y && currentUser) {
            const tijd = Date.now() - mazeStartTime;
            alert(`üéâ Je hebt Jezus gevonden in ${formatTime(tijd)}!`);
            if(mazeTimerInterval) clearInterval(mazeTimerInterval);
            
            push(ref(db, 'leaderboard/maze'), {
                naam: currentUser,
                tijd: tijd,
                formattedTime: formatTime(tijd)
            });
            
            // Update leaderboard display
            loadLeaderboard();
        } else {
            alert('Je bent nog niet bij Jezus!');
        }
    };

    window.resetMaze = () => {
        maze.disciple = { x: 0, y: 0 };
        drawMaze();
    };

    // 16. Leaderboard
    function loadLeaderboard() {
        const leaderboardList = document.getElementById('leaderboard-list');
        
        // Haal alle tijden op en sorteer
        const allTimes = [];
        
        onValue(ref(db, 'leaderboard'), (snapshot) => {
            if(snapshot.exists()) {
                const data = snapshot.val();
                leaderboardList.innerHTML = '';
                
                // Verzamel alle tijden
                Object.values(data).forEach(category => {
                    Object.values(category).forEach(entry => {
                        allTimes.push(entry);
                    });
                });
                
                // Sorteer op tijd (snelste eerst)
                allTimes.sort((a, b) => a.tijd - b.tijd);
                
                // Toon top 10
                allTimes.slice(0, 10).forEach((entry, index) => {
                    const div = document.createElement('div');
                    div.className = `leaderboard-item rank-${index + 1}`;
                    div.innerHTML = `<span>${index + 1}. ${entry.naam}</span> <span>${entry.formattedTime}</span>`;
                    leaderboardList.appendChild(div);
                });
            }
        }, { onlyOnce: true });
    }

    // 17. Initialisatie
    window.onload = () => {
        const savedName = localStorage.getItem('mijnNaam');
        if(savedName) {
            document.getElementById('name-input').value = savedName;
        }
        
        document.getElementById('name-input').addEventListener('change', (e) => {
            localStorage.setItem('mijnNaam', e.target.value);
        });
        
        initDragDrop();
        initWoordveld();
        drawMaze();
        loadAnswers();
        loadLeaderboard();
    };
</script>
</body>
</html>
