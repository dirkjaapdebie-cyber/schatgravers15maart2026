<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Schatgravers V33</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --primary: #1e3799; --accent: #eb4d4b; --success: #20bf6b; --bg: #0a3d62; --gold: #f1c40f; }
        body, html { margin: 0; padding: 0; height: 100vh; font-family: 'Fredoka', sans-serif; overflow: hidden; background: var(--bg); color: #333; }
        
        .bg-fixed { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(10, 61, 98, 0.9), rgba(10, 61, 98, 0.9)), url('schatgravers15maart.jpg'); background-size: cover; z-index: -1; }
        
        /* Containers moeten standaard op display:none staan, behalve fase 1 */
        .container { display: none; height: 100vh; padding: 15px; box-sizing: border-box; flex-direction: column; align-items: center; overflow-y: auto; padding-bottom: 110px; }
        #phase-1 { display: flex; } /* Zorg dat er altijd iets zichtbaar is bij start */

        .navigation-panel { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 6px; z-index: 10000; background: rgba(0,0,0,0.8); padding: 8px 12px; border-radius: 40px; }
        .nav-btn { width: 38px; height: 38px; border-radius: 50%; border: 2px solid white; background: transparent; color: white; font-weight: bold; cursor: pointer; }
        .nav-btn.active { background: white; color: var(--bg); box-shadow: 0 0 12px white; }

        .story-box { background: white; padding: 20px; border-radius: 20px; width: 90%; max-width: 500px; }
        .vault { background: rgba(255,255,255,0.9); padding: 10px; border-radius: 12px; font-size: 0.7rem; min-height: 60px; border: 3px solid transparent; width: 100%; box-sizing: border-box; }
        .vault.active { border-color: var(--gold); background: white; transform: scale(1.05); }
        .name-tag { background: var(--gold); color: #000; padding: 8px 12px; border-radius: 20px; font-weight: bold; margin: 4px; display: inline-block; }
        .name-tag.selected { background: var(--accent); color: white; }
        .prayer-card { background: white; padding: 12px; border-radius: 15px; border: 2px dashed #ccc; width: 100%; margin-bottom: 8px; box-sizing: border-box; }
        .prayer-card.filled { border: 2px solid var(--success); background: #f0fff4; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; }
        .input-field { width: 100%; max-width: 300px; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; font-family: 'Fredoka'; }
        #ws-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 2px; width: 95vw; max-width: 380px; }
        .ws-letter { aspect-ratio: 1/1; background: white; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; border-radius: 4px; }
        .ws-letter.found { background: var(--gold); }
    </style>
</head>
<body>

<div class="bg-fixed"></div>

<div id="phase-1" class="container">
    <div style="background:white; padding:30px; border-radius:20px; text-align:center; width:90%;">
        <h2>Schatgravers</h2>
        <input type="text" id="name-in" placeholder="Jouw naam..." class="input-field">
        <button onclick="sendName()" class="btn">START</button>
        <div id="display-names-list" style="margin-top:15px; display:flex; flex-wrap:wrap; justify-content:center;"></div>
    </div>
</div>

<div id="phase-2" class="container">
    <h1 id="timer-p2" style="color:white; font-size:3rem; margin:10px;">01:30</h1>
    <div style="width:100%; max-width:280px; aspect-ratio:9/16; background:#000; border-radius:15px; overflow:hidden; border:3px solid var(--gold);">
        <iframe id="yt-player" src="https://www.youtube.com/embed/7ljG1XWMYjY?enablejsapi=1" style="width:100%; height:100%; border:none;" allowfullscreen></iframe>
    </div>
    <a href="https://earth.google.com/web/search/Mount+of+Olives" target="_blank" class="btn" style="margin-top:15px; background:var(--accent); text-decoration:none; width:200px; text-align:center;">üåç GOOGLE EARTH</a>
</div>

<div id="phase-3" class="container">
    <div class="story-box">
        <img src="schatgravers15maart.jpg" style="width:100%; border-radius:10px; margin-bottom:15px; border:3px solid var(--gold);">
        <div style="font-size:1.1rem; line-height:1.4;">
            <strong>Lukas 22:39-46</strong><br><br>
            Jezus knielde neer en bad: <em>"Vader, laat niet wat Ik wil, maar wat U wilt gebeuren."</em><br><br>
            Een engel gaf Hem kracht. Jezus was zo bang dat Zijn zweet als druppels bloed op de grond viel.
        </div>
    </div>
</div>

<div id="phase-4" class="container">
    <div style="background:white; padding:15px; border-radius:15px; text-align:center; width:95%; margin-bottom:15px;">
        <div id="dice-display" style="font-size:3rem;">üé≤</div>
        <p id="stelling-text" style="font-weight:bold; color:var(--primary); margin:10px 0;"></p>
        <button onclick="triggerRoll()" class="btn" style="background:var(--gold); color:black;">GOOI DOBBELSTEEN</button>
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%;">
        <div class="vault" id="v-1"><b>1. ANGST</b><div id="l1"></div></div>
        <div class="vault" id="v-2"><b>2. KEUZES</b><div id="l2"></div></div>
        <div class="vault" id="v-3"><b>3. ENGELEN</b><div id="l3"></div></div>
        <div class="vault" id="v-4"><b>4. BIDDEN</b><div id="l4"></div></div>
        <div class="vault" id="v-5"><b>5. ALLEEN</b><div id="l5"></div></div>
        <div class="vault" id="v-6"><b>6. HERSTEL</b><div id="l6"></div></div>
    </div>
    <input type="text" id="thought-in" placeholder="Typ je gedachte..." class="input-field" style="margin-top:15px;">
    <button onclick="sendThought()" class="btn" style="background:var(--success);">STUUR NAAR KLUIS</button>
</div>

<div id="phase-5" class="container">
    <h3 style="color:white; text-shadow: 2px 2px 4px black; margin: 5px;">Wie bad wat?</h3>
    <div id="names-source" style="margin-bottom:10px;"></div>
    <div id="prayer-targets" style="width:100%;"></div>
</div>

<div id="phase-6" class="container">
    <h1 id="ws-timer" style="color:white; margin:5px;">03:00</h1>
    <div id="ws-grid"></div>
    <div id="ws-list" style="background:white; display:grid; grid-template-columns:repeat(3,1fr); font-size:0.5rem; padding:8px; margin:10px 0; border-radius:10px; width:95%;"></div>
    <input type="text" id="final-sentence" placeholder="Wat is de verborgen zin?" class="input-field" oninput="checkSentence(this.value)">
</div>

<div class="navigation-panel">
    <button class="nav-btn" id="btn-p1" onclick="navTo('p1')">1</button>
    <button class="nav-btn" id="btn-p2" onclick="navTo('p2')">2</button>
    <button class="nav-btn" id="btn-p3" onclick="navTo('p3')">3</button>
    <button class="nav-btn" id="btn-p4" onclick="navTo('p4')">4</button>
    <button class="nav-btn" id="btn-p5" onclick="navTo('p5')">5</button>
    <button class="nav-btn" id="btn-p6" onclick="navTo('p6')">6</button>
    <button class="nav-btn" style="background:var(--accent); margin-left:10px;" onclick="fullReset()">R</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54", 
        authDomain: "schatgravers15maart2026.firebaseapp.com", 
        databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app", 
        projectId: "schatgravers15maart2026", 
        appId: "1:30561512857:web:fcb7868b87d292d1c97708" 
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Variabelen
    let currentDice = 1;
    let selectedName = "";
    let selectedTag = null;
    const stellingen = ["1. Ik ben nooit bang.", "2. Soms hoop ik dat een taak niet doorgaat.", "3. Ik sta altijd klaar voor anderen.", "4. Ik bid direct als ik bang ben.", "5. Ik voel me weleens alleen.", "6. Ik doe wat God vraagt."];

    // Navigatie Logica
    window.navTo = (p) => set(ref(db, 'currentPhase'), p);
    
    onValue(ref(db, 'currentPhase'), (snapshot) => {
        const p = snapshot.val() || 'p1';
        document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
        const activeContainer = document.getElementById('phase-' + p.replace('p',''));
        if(activeContainer) activeContainer.style.display = 'flex';
        
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        const activeBtn = document.getElementById('btn-' + p);
        if(activeBtn) activeBtn.classList.add('active');

        if(p === 'p5') initMatcher();
        if(p === 'p6') initWordSearch();
    });

    // Fase 1: Namen
    window.sendName = () => {
        const name = document.getElementById('name-in').value;
        if(name) push(ref(db, 'names'), name);
        document.getElementById('name-in').value = '';
    };

    onValue(ref(db, 'names'), (snapshot) => {
        const list = document.getElementById('display-names-list');
        list.innerHTML = '';
        if(snapshot.exists()) {
            Object.values(snapshot.val()).forEach(n => {
                list.innerHTML += `<span class="name-tag" style="font-size:0.7rem;">${n}</span>`;
            });
        }
    });

    // Fase 4: Dobbelsteen
    window.triggerRoll = () => set(ref(db, 'dice'), Math.floor(Math.random() * 6) + 1);
    window.sendThought = () => {
        const t = document.getElementById('thought-in').value;
        if(t) push(ref(db, 'vaults/' + currentDice), t);
        document.getElementById('thought-in').value = '';
    };

    onValue(ref(db, 'dice'), (snapshot) => {
        currentDice = snapshot.val() || 1;
        document.getElementById('dice-display').innerText = ["‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"][currentDice-1];
        document.getElementById('stelling-text').innerText = stellingen[currentDice-1];
        document.querySelectorAll('.vault').forEach(v => v.classList.remove('active'));
        document.getElementById('v-' + currentDice).classList.add('active');
    });

    onValue(ref(db, 'vaults'), (snapshot) => {
        for(let i=1; i<=6; i++) {
            const v = document.getElementById('l'+i);
            v.innerHTML = '';
            if(snapshot.exists() && snapshot.val()[i]) {
                Object.values(snapshot.val()[i]).slice(-2).forEach(txt => {
                    v.innerHTML += `<div style="font-size:0.5rem; color:#555;">‚Ä¢ ${txt}</div>`;
                });
            }
        }
    });

    // Fase 5: Matcher
    const mData = [
        {n:"Abraham", g:"Wilt u de stad sparen om 10 rechtvaardigen?"},
        {n:"David", g:"Was mij schoon, maak mij witter dan sneeuw."},
        {n:"Jezus", g:"Niet mijn wil, maar Uw wil geschiede."},
        {n:"Salomo", g:"Geef mij een hart dat naar U luistert."},
        {n:"Hanna", g:"Geef mij een zoon, hij zal U dienen."}
    ];

    function initMatcher() {
        const src = document.getElementById('names-source');
        const trg = document.getElementById('prayer-targets');
        src.innerHTML = ''; trg.innerHTML = '';
        
        [...mData].sort(()=>Math.random()-0.5).forEach(item => {
            const tag = document.createElement('div');
            tag.className = 'name-tag';
            tag.innerText = item.n;
            tag.onclick = () => {
                document.querySelectorAll('.name-tag').forEach(t => t.classList.remove('selected'));
                tag.classList.add('selected');
                selectedName = item.n;
                selectedTag = tag;
            };
            src.appendChild(tag);
        });

        mData.forEach(item => {
            const card = document.createElement('div');
            card.className = 'prayer-card';
            card.innerHTML = `<i>"${item.g}"</i>`;
            card.onclick = () => {
                if(selectedName === item.n) {
                    card.innerHTML = `<b>${item.n}</b><br><i>"${item.g}"</i>`;
                    card.classList.add('filled');
                    selectedTag.style.display = 'none';
                    selectedName = "";
                    confetti({particleCount:30});
                }
            };
            trg.appendChild(card);
        });
    }

    // Fase 6: Woordzoeker (Versimpeld voor stabiliteit)
    function initWordSearch() {
        const grid = document.getElementById('ws-grid');
        grid.innerHTML = '';
        for(let i=0; i<144; i++) {
            const l = document.createElement('div');
            l.className = 'ws-letter';
            l.innerText = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*26)];
            l.onclick = () => l.classList.toggle('found');
            grid.appendChild(l);
        }
    }

    window.checkSentence = (v) => {
        if(v.toLowerCase().trim() === "van u is het koninkrijk") confetti({particleCount:150});
    };

    window.fullReset = () => {
        if(confirm("Alles wissen?")) {
            remove(ref(db)).then(() => location.reload());
        }
    };

</script>
</body>
</html>
