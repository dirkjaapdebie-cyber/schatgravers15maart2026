<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schatgravers Live Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3799; /* Donkerder blauw */
            --secondary: #4834d4;
            --accent: #ff7675;
            --success: #20bf6b;
            --danger: #eb4d4b;
            --white: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Fredoka', sans-serif;
            margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
            background: linear-gradient(135deg, #0a3d62 0%, #1e3799 100%);
            position: relative;
        }

        /* Achtergrondafbeelding vervaagd en donker */
        body::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('schatgravers15maart.jpg');
            background-size: cover; background-position: center;
            opacity: 0.15; filter: blur(10px); z-index: -1;
        }

        /* DEEL 1: Wie zijn er */
        .names-bar {
            background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px);
            padding: 15px 25px; border-bottom: 2px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; gap: 20px;
        }
        .name-tag {
            background: var(--white); color: var(--primary); padding: 8px 18px;
            border-radius: 50px; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: pop 0.4s ease; white-space: nowrap;
        }

        /* DEEL 2: Het Speelveld */
        .main-stage { display: flex; flex: 1; padding: 25px; gap: 25px; overflow: hidden; }

        .dice-zone {
            width: 350px; background: var(--white); border-radius: 40px;
            padding: 30px; display: flex; flex-direction: column; align-items: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4);
        }

        .scene { width: 100px; height: 100px; perspective: 600px; margin: 20px; cursor: pointer; }
        .cube { 
            width: 100%; height: 100%; position: relative; transform-style: preserve-3d; 
            transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.3, 1.1); 
        }
        .cube__face { 
            position: absolute; width: 100px; height: 100px; background: white; 
            border: 4px solid var(--primary); line-height: 100px; font-size: 45px; 
            border-radius: 20px; text-align: center; color: var(--primary); font-weight: bold;
        }
        .cube__face--1 { transform: rotateY(0deg) translateZ(50px); }
        .cube__face--2 { transform: rotateY(180deg) translateZ(50px); }
        .cube__face--3 { transform: rotateY(-90deg) translateZ(50px); }
        .cube__face--4 { transform: rotateY(90deg) translateZ(50px); }
        .cube__face--5 { transform: rotateX(-90deg) translateZ(50px); }
        .cube__face--6 { transform: rotateX(90deg) translateZ(50px); }

        .thought-cloud {
            flex: 1; background: rgba(255, 255, 255, 0.05); border-radius: 40px;
            padding: 30px; border: 3px dashed rgba(255,255,255,0.2);
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px; overflow-y: auto; align-content: start;
        }

        .bubble {
            background: white; padding: 20px; border-radius: 30px 30px 30px 5px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15); animation: float 4s ease-in-out infinite;
            font-size: 1.1rem; color: #2d3436;
        }

        /* DEEL 3: De 6 Schatkamers */
        .treasure-vaults {
            height: 30%; display: grid; grid-template-columns: repeat(6, 1fr);
            gap: 15px; padding: 15px 25px; background: rgba(0,0,0,0.3); position: relative;
        }

        .vault { background: var(--white); border-radius: 25px; padding: 12px; overflow-y: auto; }
        .vault h4 { margin: 0 0 10px 0; font-size: 0.85rem; color: var(--primary); text-align: center; border-bottom: 2px solid #eee; }

        /* Knoppen & Input */
        input { 
            width: 100%; padding: 15px; border-radius: 30px; border: 2px solid #ddd; 
            font-family: inherit; margin-bottom: 12px; outline: none; box-sizing: border-box;
        }
        .btn {
            width: 100%; padding: 15px; border-radius: 30px; border: none; 
            color: white; font-weight: bold; font-family: inherit; cursor: pointer; transition: 0.2s;
        }
        .btn-roll { background: var(--primary); box-shadow: 0 5px 0 #0a3d62; margin-bottom: 12px; }
        .btn-send { background: var(--success); box-shadow: 0 5px 0 #1b8d50; }
        
        /* De Harde Reset Knop */
        .btn-reset {
            position: absolute; bottom: 8px; right: 8px; width: auto; padding: 6px 15px;
            background: var(--danger); font-size: 0.7rem; border-radius: 12px;
            box-shadow: 0 3px 0 #c0392b; opacity: 0.6;
        }
        .btn-reset:hover { opacity: 1; transform: scale(1.05); }

        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }
    </style>
</head>
<body>

<div class="names-bar">
    <div style="display: flex; gap: 12px;">
        <input type="text" id="name-in" placeholder="Je naam..." style="width: 180px; margin:0">
        <button onclick="sendName()" class="btn" style="width: auto; background: var(--success); box-shadow: 0 4px 0 #1b8d50;">Verstuur</button>
    </div>
    <div class="name-container" id="names-display" style="display: flex; gap: 12px; overflow-x: auto; flex-grow: 1;"></div>
</div>

<div class="main-stage">
    <div class="dice-zone">
        <div class="scene" onclick="triggerRoll()">
            <div class="cube" id="cube">
                <div class="cube__face cube__face--1">1</div>
                <div class="cube__face cube__face--2">2</div>
                <div class="cube__face cube__face--3">3</div>
                <div class="cube__face cube__face--4">4</div>
                <div class="cube__face cube__face--5">5</div>
                <div class="cube__face cube__face--6">6</div>
            </div>
        </div>
        <button class="btn btn-roll" onclick="triggerRoll()">GOOI DOBBELSTEEN</button>
        <div id="active-statement" style="text-align:center; font-weight:600; color: var(--primary); margin: 10px 0; min-height: 50px; display: flex; align-items: center;">Gooi om te beginnen!</div>
        <input type="text" id="thought-in" placeholder="Wat denk je nu?">
        <button class="btn btn-send" onclick="sendThought()">DEEL JE GEDACHTE ✨</button>
    </div>

    <div class="thought-cloud" id="live-thoughts"></div>
</div>

<div class="treasure-vaults">
    <div class="vault" id="v1"><h4>❶ Nooit bang</h4><div id="c1"></div></div>
    <div class="vault" id="v2"><h4>❷ Spannend</h4><div id="c2"></div></div>
    <div class="vault" id="v3"><h4>❸ Helpen</h4><div id="c3"></div></div>
    <div class="vault" id="v4"><h4>❹ Bidden</h4><div id="c4"></div></div>
    <div class="vault" id="v5"><h4>❺ Kracht</h4><div id="c5"></div></div>
    <div class="vault" id="v6"><h4>❻ God's Wil</h4><div id="c6"></div></div>
    
    <button class="btn btn-reset" onclick="hardReset()">HARDE RESET (LEEGMAKEN)</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54",
        authDomain: "schatgravers15maart2026.firebaseapp.com",
        projectId: "schatgravers15maart2026",
        databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app",
        storageBucket: "schatgravers15maart2026.firebasestorage.app",
        messagingSenderId: "30561512857",
        appId: "1:30561512857:web:fcb7868b87d292d1c97708"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let currentRollNum = 0;
    const stellingen = ["Ik ben nooit bang.", "Als ik iets spannend vind, hoop ik dat het niet doorgaat.", "Als iemand het moeilijk heeft, help ik.", "Als ik bang ben, ga ik bidden.", "Ik heb kracht van God gevoeld.", "Ik wil meer weten over wat God wil."];

    // FUNCTIE: Naam toevoegen
    window.sendName = () => {
        const val = document.getElementById('name-in').value;
        if(val) { push(ref(db, 'names'), val); document.getElementById('name-in').value = ''; }
    };

    // FUNCTIE: Dobbelen & Archiveren
    window.triggerRoll = () => {
        if(currentRollNum > 0) {
            onValue(ref(db, 'live'), snap => {
                const d = snap.val(); 
                if(d) Object.values(d).forEach(t => push(ref(db, `vault/v${currentRollNum}`), t));
            }, {onlyOnce: true});
        }
        remove(ref(db, 'live'));
        const r = Math.floor(Math.random()*6)+1;
        set(ref(db, 'gameState'), {r, t: Date.now()});
    };

    // FUNCTIE: Gedachte sturen
    window.sendThought = () => {
        const val = document.getElementById('thought-in').value;
        if(val && currentRollNum > 0) { push(ref(db, 'live'), val); document.getElementById('thought-in').value = ''; }
    };

    // FUNCTIE: De Harde Reset (Wist alles!)
    window.hardReset = () => {
        if(confirm("LET OP: Wil je echt alles wissen? Dit verwijdert alle namen en alle verzamelde teksten!")) {
            remove(ref(db, '/')).then(() => {
                alert("Database is helemaal schoon!");
                location.reload();
            });
        }
    };

    // SYNC: Namen
    onValue(ref(db, 'names'), s => {
        const div = document.getElementById('names-display'); div.innerHTML = "";
        const data = s.val(); if(data) Object.values(data).forEach(n => {
            const span = document.createElement('span'); span.className = 'name-tag'; span.innerText = n; div.appendChild(span);
        });
    });

    // SYNC: Dobbelsteen & Stelling
    onValue(ref(db, 'gameState'), s => {
        const d = s.val(); if(d) {
            currentRollNum = d.r;
            const cube = document.getElementById('cube');
            const rotations = {1:'rotateY(0deg)', 2:'rotateY(180deg)', 3:'rotateY(-90deg)', 4:'rotateY(90deg)', 5:'rotateX(-90deg)', 6:'rotateX(90deg)'};
            cube.style.transform = rotations[d.r];
            document.getElementById('active-statement').innerText = stellingen[d.r-1];
        }
    });

    // SYNC: Live Gedachten
    onValue(ref(db, 'live'), s => {
        const grid = document.getElementById('live-thoughts'); grid.innerHTML = "";
        const data = s.val(); if(data) Object.values(data).forEach(t => {
            const b = document.createElement('div'); b.className = 'bubble'; b.innerText = t; grid.appendChild(b);
        });
    });

    // SYNC: 6 Schatkamers
    for(let i=1; i<=6; i++) {
        onValue(ref(db, `vault/v${i}`), s => {
            const cont = document.getElementById(`c${i}`); cont.innerHTML = "";
            const data = s.val(); if(data) Object.values(data).forEach(t => {
                const m = document.createElement('div'); m.style = "font-size:0.75rem; background:#f1f2f6; margin:4px; padding:6px; border-radius:12px; border-left: 3px solid var(--accent);"; m.innerText = t; cont.appendChild(m);
            });
        });
    }
</script>
</body>
</html>
