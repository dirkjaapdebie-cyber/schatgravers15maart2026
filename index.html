<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schatgravers 2026 | Dirkjaap Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Black+Ops+One&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1e3799; --accent: #eb4d4b; --bg: #0a3d62; --gold: #f1c40f; --neon: #00d2ff; }
        body { font-family: 'Fredoka', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; overflow-x: hidden; }
        #top-bar { display: none; width: 100%; max-width: 600px; justify-content: space-between; align-items: center; padding: 12px; background: rgba(0,0,0,0.6); border-radius: 15px; margin: 0 auto 10px auto; border: 2px solid var(--neon); box-sizing: border-box; }
        .screen { display: none; width: 100%; max-width: 600px; text-align: center; margin: 0 auto; animation: fadeIn 0.4s ease; }
        .screen.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: white; color: #333; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); margin: 15px 0; }
        
        /* ADMIN PANEL - DIRKJAAP ONLY */
        #admin-panel { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: var(--accent); padding: 10px; z-index: 1000; border-top: 3px solid white; }
        .admin-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; max-width: 600px; margin: 0 auto; }
        .btn-nav { background: white; color: var(--accent); font-size: 0.7rem; padding: 8px; font-weight: bold; border: none; border-radius: 5px; cursor: pointer; text-transform: uppercase; }

        .player-tag { background: var(--neon); color: #000; padding: 6px 12px; border-radius: 20px; font-weight: bold; font-size: 0.8rem; border: 1px solid white; display: inline-block; margin: 3px; }
        .opinion-tag { background: #eee; padding: 10px; border-radius: 10px; font-size: 0.9rem; text-align: left; border-left: 5px solid var(--primary); margin-bottom: 5px; color: #333; }
        
        .btn { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; }
        .btn-gold { background: var(--gold); color: #333; margin-top: 10px; }

        #ws-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 2px; background: #333; padding: 2px; border-radius: 5px; }
        .ws-letter { background: white; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: bold; cursor: pointer; }
        .ws-letter.selected { background: var(--neon); color: white; }

        #maze-container { position: relative; width: 300px; height: 300px; background: #111; border: 4px solid var(--neon); margin: 0 auto; overflow: hidden; }
        .wall { position: absolute; background: #555; }
        #guard { position: absolute; background: red; color: white; font-weight: bold; display: flex; align-items: center; justify-content: center; border-radius: 3px; }
        #player { position: absolute; background: var(--neon); border-radius: 50%; border: 2px solid white; z-index: 10; transition: 0.1s; }
        
        input { width: 100%; padding: 15px; border-radius: 12px; border: 2px solid #ddd; box-sizing: border-box; font-size: 1rem; }
    </style>
</head>
<body>

    <div id="admin-panel">
        <div style="font-size: 0.7rem; text-align: center; margin-bottom: 5px; font-weight: bold; color: white;">CAPTAIN DIRKJAAP CONTROL</div>
        <div class="admin-grid">
            <button class="btn btn-nav" onclick="syncStep(1)">LOBBY</button>
            <button class="btn btn-nav" onclick="syncStep(2)">MAP</button>
            <button class="btn btn-nav" onclick="syncStep(3)">STORY</button>
            <button class="btn btn-nav" onclick="syncStep(4)">FEED</button>
            <button class="btn btn-nav" onclick="syncStep(5)">PUZZLE</button>
            <button class="btn btn-nav" onclick="syncStep(6)">DRAG</button>
            <button class="btn btn-nav" onclick="syncStep(7)">MAZE</button>
            <button class="btn btn-nav" style="background: black; color: white;" onclick="resetGame()">RESET</button>
        </div>
        <button class="btn btn-nav" style="width:100%; margin-top:5px; background:var(--gold); color:black;" onclick="draaiWiel()">NIEUWE STELLING</button>
    </div>

    <div id="top-bar">
        <span id="display-name" style="color: var(--neon); font-weight: bold;">---</span>
        <div id="game-timer" style="font-family:'Black Ops One'; color: var(--gold);">00:00</div>
    </div>

    <div id="screen-1" class="screen active">
        <h1 style="font-family:'Black Ops One'; color:var(--gold); font-size: 3rem; margin-bottom: 0;">SQUAD</h1>
        <div class="card">
            <input type="text" id="name-in" placeholder="VOER JE NAAM IN...">
            <button onclick="joinGame()" class="btn btn-gold">START MISSIE</button>
        </div>
        <div id="names-list"></div>
    </div>

    <div id="screen-2" class="screen">
        <h2>LOCATIE: OLIJFBERG</h2>
        <div class="card" style="padding:5px; height:350px;">
            <iframe src="https://www.google.com/maps/embed?pb=!4v1700000000000!6m8!1m2!1sAF1QipO_R9N-hL-j7uS6gYh!2s!7i13312!8i6656" width="100%" height="100%" style="border:0; border-radius:15px;" allowfullscreen></iframe>
        </div>
    </div>

    <div id="screen-3" class="screen">
        <h2>HET VERHAAL</h2>
        <div class="card" style="text-align:left; height:380px; overflow-y:scroll; padding: 25px; line-height: 1.6;">
            <p><strong>De Nacht van Gethsemane:</strong> Jezus wist dat de soldaten zouden komen. Terwijl de stad sliep, bad Hij op de Olijfberg.</p>
            <p>Zijn vrienden, Petrus, Johannes en Jakobus, moesten waken. Maar de slaap was te sterk. "Kunnen jullie niet één uur met mij waken?" vroeg Jezus verdrietig.</p>
            <p>Toen verbrak het geluid van marcherende voeten de stilte. Judas stapte naar voren. Met een kus — een teken van vriendschap — verraadde hij Jezus.</p>
        </div>
    </div>

    <div id="screen-4" class="screen">
        <h2>LIVE DISCO FEED</h2>
        <div id="active-stelling" class="card" style="font-weight:bold; font-size:1.3rem; background: var(--neon); color: black; min-height: 60px; display: flex; align-items: center; justify-content: center;">Wachten op Dirkjaap...</div>
        <div class="card">
            <input type="text" id="opinion-in" placeholder="Wat vind jij?">
            <button onclick="stuurMening()" class="btn btn-gold">POSTEN</button>
        </div>
        <div id="live-opinions"></div>
    </div>

    <div id="screen-5" class="screen">
        <h2>DECODEER DE BOODSCHAP</h2>
        <div id="ws-grid"></div>
        <div id="ws-words" style="display:flex; flex-wrap:wrap; gap:5px; margin:10px 0; justify-content:center;"></div>
        <div class="card">
            <p style="font-size:0.8rem; margin-bottom: 5px;">Vind de woorden en typ de overgebleven zin:</p>
            <input type="text" id="secret-in" placeholder="DE CODE IS...">
            <button onclick="stuurGeheim()" class="btn btn-gold">CHECK CODE</button>
        </div>
    </div>

    <div id="screen-6" class="screen">
        <h2>MATCH DE GEBEDEN</h2>
        <div id="draggables" style="margin-bottom:20px;">
            <div class="player-tag drag-item" draggable="true" id="d-jezus" style="cursor:grab; background:var(--gold);">Jezus</div>
            <div class="player-tag drag-item" draggable="true" id="d-mozes" style="cursor:grab; background:var(--gold);">Mozes</div>
            <div class="player-tag drag-item" draggable="true" id="d-nehemia" style="cursor:grab; background:var(--gold);">Nehemia</div>
        </div>
        <div class="card" style="text-align:left;">
            <div class="drop-zone" data-target="d-jezus" style="border:2px dashed #ccc; padding:15px; margin:10px 0; border-radius:10px;">"Vader, vergeef hen..."</div>
            <div class="drop-zone" data-target="d-mozes" style="border:2px dashed #ccc; padding:15px; margin:10px 0; border-radius:10px;">"Heer, spaar uw volk!"</div>
            <div class="drop-zone" data-target="d-nehemia" style="border:2px dashed #ccc; padding:15px; margin:10px 0; border-radius:10px;">"Ik deed een schietgebedje..."</div>
        </div>
    </div>

    <div id="screen-7" class="screen">
        <h2>ESCAPE THE GUARD</h2>
        <div id="maze-container">
            <div class="wall" style="top:70px; left:0; width:220px; height:12px;"></div>
            <div class="wall" style="top:160px; left:80px; width:220px; height:12px;"></div>
            <div id="guard" style="top:190px; left:0; width:45px; height:45px;">!</div>
            <div id="player" style="top:10px; left:10px; width:22px; height:22px;"></div>
            <div style="position:absolute; bottom:10px; right:10px; color:var(--gold); font-weight:bold; font-size:12px;">FINISH</div>
        </div>
        <div style="display:grid; grid-template-columns:repeat(3,1fr); width:180px; margin:20px auto; gap:10px;">
            <button class="btn" style="grid-column:2" onclick="moveMaze(0,-25)">↑</button>
            <button class="btn" onclick="moveMaze(-25,0)">←</button>
            <button class="btn" onclick="moveMaze(0,25)">↓</button>
            <button class="btn" onclick="moveMaze(25,0)">→</button>
        </div>
        <div class="card" style="background:#111; color:var(--neon); padding: 10px;">
            <h4 style="margin:5px 0;">TOP TIMES</h4>
            <div id="lb-display"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54",
            databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "schatgravers15maart2026"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myName = "", isAdmin = false, timerInterval, pX=10, pY=10;

        // --- NAVIGATION SYNC ---
        db.ref('currentStep').on('value', snap => {
            const step = snap.val() || 1;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen-'+step).classList.add('active');
            if(step === 5) { startTimer(); initWS(); }
            if(step === 7) { startTimer(); initGuard(); }
        });

        function syncStep(n) { if(isAdmin) db.ref('currentStep').set(n); }

        // --- LOBBY LOGIC ---
        function joinGame() {
            const input = document.getElementById('name-in');
            const n = input.value.trim();
            if(n) {
                myName = n;
                db.ref('players').push(n);
                document.getElementById('display-name').innerText = "PLAYER: " + n.toUpperCase();
                document.getElementById('top-bar').style.display = 'flex';
                
                // ADMIN ACTIVATIE VOOR DIRKJAAP
                if(n.toLowerCase() === 'dirkjaap') {
                    isAdmin = true;
                    document.getElementById('admin-panel').style.display = 'block';
                }
            }
        }
        db.ref('players').on('value', snap => {
            const l = document.getElementById('names-list'); l.innerHTML = "";
            if(snap.exists()) Object.values(snap.val()).forEach(n => l.innerHTML += `<span class="player-tag">${n}</span>`);
        });

        // --- FEED LOGIC ---
        function draaiWiel() {
            const s = ["Echte vrienden slapen niet.", "Vergeven is een kracht.", "Bidden geeft rust.", "Ik zou ook bang zijn."];
            db.ref('activeStelling').set(s[Math.floor(Math.random()*s.length)]);
        }
        db.ref('activeStelling').on('value', snap => { if(snap.exists()) document.getElementById('active-stelling').innerText = snap.val(); });
        
        function stuurMening() {
            const t = document.getElementById('opinion-in').value;
            if(t) { db.ref('opinions').push({n: myName, t: t}); document.getElementById('opinion-in').value = ""; }
        }
        db.ref('opinions').limitToLast(5).on('value', snap => {
            const l = document.getElementById('live-opinions'); l.innerHTML = "";
            snap.forEach(c => l.innerHTML = `<div class="opinion-tag"><b>${c.val().n}:</b> ${c.val().t}</div>` + l.innerHTML);
        });

        // --- PUZZLE LOGIC (Met Oplossingszin) ---
        function initWS() {
            const g = document.getElementById('ws-grid'), w = document.getElementById('ws-words');
            const words = ["JUDAS", "PETRUS", "MARIA", "TUIN"];
            // Layout waarin overgebleven letters "GOD GEEFT KRACHT" vormen
            const layout = ['G','O','D','J','U','D','A','S','G','E','E','F','T','K','R','A','C','H','T','P','E','T','R','U','S','M','A','R','I','A','T','U','I','N','X','X'];
            g.innerHTML = ""; w.innerHTML = "";
            words.forEach(word => w.innerHTML += `<span class="player-tag" id="w-${word}" style="opacity:0.3;">${word}</span>`);
            layout.forEach(letter => {
                const d = document.createElement('div'); d.className = 'ws-letter';
                d.innerText = letter === 'X' ? "?" : letter;
                d.onclick = function() {
                    this.classList.toggle('selected');
                    const sel = Array.from(document.querySelectorAll('.ws-letter.selected')).map(e=>e.innerText).join('');
                    words.forEach(word => { if(sel.includes(word)) document.getElementById('w-'+word).style.opacity = '1'; });
                };
                g.appendChild(d);
            });
        }
        function stuurGeheim() { if(document.getElementById('secret-in').value.toUpperCase().includes("GOD GEEFT KRACHT")) alert("CODE GEKRAAKT!"); }

        // --- MAZE LOGIC ---
        function initGuard() {
            let gx = 0, gd = 1;
            setInterval(() => {
                const g = document.getElementById('guard'); if(!g) return;
                gx += (6 * gd); if(gx > 250 || gx < 0) gd *= -1;
                g.style.left = gx + 'px';
                const gr = g.getBoundingClientRect(), pr = document.getElementById('player').getBoundingClientRect();
                if(pr.left < gr.right && pr.right > gr.left && pr.top < gr.bottom && pr.bottom > gr.top) { pX=10; pY=10; updateP(); }
            }, 50);
        }
        function moveMaze(dx, dy) {
            pX += dx; pY += dy;
            if(pX<0) pX=0; if(pX>280) pX=280; if(pY<0) pY=0; if(pY>280) pY=280;
            updateP();
            if(pX > 250 && pY > 250) { 
                clearInterval(timerInterval);
                db.ref('leaderboard').push({n: myName, t: document.getElementById('game-timer').innerText});
                alert("MISSIE VOLBRACHT!");
            }
        }
        function updateP() { const p = document.getElementById('player'); p.style.left = pX+'px'; p.style.top = pY+'px'; }

        // --- UTILS ---
        function startTimer() {
            let s = 0; clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                s++; let m = Math.floor(s/60);
                document.getElementById('game-timer').innerText = `${m}:${(s%60).toString().padStart(2,'0')}`;
            }, 1000);
        }
        db.ref('leaderboard').orderByChild('t').limitToFirst(5).on('value', snap => {
            const d = document.getElementById('lb-display'); d.innerHTML = "";
            snap.forEach(c => d.innerHTML += `<div style="font-size:0.7rem;">${c.val().t} - ${c.val().n}</div>`);
        });
        function resetGame() {
            if(confirm("DIT WIST ALLE DATA. DOORGAAN?")) {
                db.ref('/').set({currentStep:1, players:null, opinions:null, activeStelling:"Wachten...", leaderboard:null}).then(()=>location.reload());
            }
        }

        // Drag & Drop
        document.addEventListener('dragstart', e => { if(e.target.classList.contains('drag-item')) e.dataTransfer.setData('text', e.target.id); });
        document.addEventListener('dragover', e => e.preventDefault());
        document.addEventListener('drop', e => {
            const zone = e.target.closest('.drop-zone');
            if(zone) {
                const id = e.dataTransfer.getData('text');
                if(zone.dataset.target === id) { zone.style.background = "#d4edda"; zone.appendChild(document.getElementById(id)); }
            }
        });
    </script>
</body>
</html>
