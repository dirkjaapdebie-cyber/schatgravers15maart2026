<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Schatgravers - Complete Experience</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54&callback=initMap" async defer></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Fredoka', sans-serif; background: #0a3d62; min-height: 100vh; display: flex; justify-content: center; padding: 10px; }
        
        /* Main container */
        #app { width: 100%; max-width: 450px; position: relative; }
        
        /* Screens */
        .screen { display: none; background: white; border-radius: 30px; padding: 20px; min-height: 80vh; box-shadow: 0 20px 40px rgba(0,0,0,0.4); animation: fadeIn 0.5s; margin-bottom: 20px; }
        .screen.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Admin bar */
        #admin-bar { background: #1e3799; color: white; padding: 15px; border-radius: 50px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        #admin-bar button { background: #f6b93b; border: none; padding: 10px 25px; border-radius: 30px; font-weight: bold; color: #1e3799; font-size: 1.2rem; cursor: pointer; box-shadow: 0 3px 0 #b86d0c; }
        #screen-indicator { background: rgba(255,255,255,0.2); padding: 8px 20px; border-radius: 30px; font-weight: bold; }
        
        /* Common styles */
        h2 { color: #1e3799; margin-bottom: 20px; font-size: 1.8rem; text-align: center; }
        input, textarea { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 15px; font-family: 'Fredoka', sans-serif; }
        .btn { background: #1e3799; color: white; border: none; padding: 15px 25px; border-radius: 50px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.2rem; margin: 10px 0; }
        
        /* Live feed */
        .live-feed { background: #f1f2f6; padding: 15px; border-radius: 20px; margin-top: 20px; max-height: 300px; overflow-y: auto; }
        .name-tag { background: white; padding: 10px; margin: 5px 0; border-radius: 10px; border-left: 5px solid #20bf6b; animation: slideIn 0.3s; }
        
        /* Map */
        #map { height: 400px; border-radius: 20px; margin: 15px 0; }
        
        /* Rad van Fortuin */
        .wheel-container { position: relative; width: 300px; height: 300px; margin: 20px auto; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#f6b93b 0deg 60deg, #1e3799 60deg 120deg, #20bf6b 120deg 180deg, #e55039 180deg 240deg, #fa983a 240deg 300deg, #b71540 300deg 360deg); transition: transform 3s cubic-bezier(0.25, 0.1, 0.15, 1); border: 5px solid #333; }
        #wheel-pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 40px; color: #333; z-index: 10; }
        #wheel-number { text-align: center; font-size: 2rem; margin: 10px; color: #1e3799; }
        
        /* Stelling cards */
        .stelling-card { background: #f8f9fa; padding: 15px; border-radius: 15px; margin: 15px 0; border: 2px solid #1e3799; }
        .antwoorden-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; margin-top: 10px; }
        .antwoord-item { background: white; padding: 8px; border-radius: 8px; border-left: 3px solid #20bf6b; font-size: 0.9rem; }
        
        /* Drag & Drop */
        .drag-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .bijbel-figuren, .gebeden { background: #f1f2f6; padding: 15px; border-radius: 15px; }
        .figuur-card { background: white; padding: 10px; margin: 8px 0; border-radius: 10px; border: 2px solid #1e3799; cursor: grab; text-align: center; font-weight: bold; }
        .gebed-card { background: #e3f2fd; padding: 10px; margin: 8px 0; border-radius: 10px; border: 2px dashed #1e3799; min-height: 60px; }
        .matched { background: #c8e6c9; border: 2px solid #20bf6b; }
        
        /* Doolhof */
        #maze-canvas { width: 100%; height: 450px; border-radius: 20px; background: #2d5a27; display: block; margin: 10px 0; border: 3px solid #8B4513; }
        .controls { display: flex; justify-content: center; gap: 20px; margin: 15px 0; }
        .control-btn { background: #1e3799; color: white; border: none; width: 60px; height: 60px; border-radius: 30px; font-size: 2rem; cursor: pointer; }
    </style>
</head>
<body>
<div id="app">
    <!-- Admin Bar - Alleen zichtbaar voor beheerder -->
    <div id="admin-bar">
        <span id="screen-indicator">Scherm 1/6</span>
        <button id="next-screen-btn"><i class="fas fa-arrow-right"></i> Volgende</button>
    </div>

    <!-- Scherm 1: Login + Live Feed -->
    <div id="screen1" class="screen active">
        <h2>üëã Welkom Schatgravers!</h2>
        <input type="text" id="name-input" placeholder="Jouw naam...">
        <button onclick="saveUser()" class="btn"><i class="fas fa-sign-in-alt"></i> Doe mee!</button>
        
        <div class="live-feed">
            <h3>üì± Live feed</h3>
            <div id="name-list"></div>
        </div>
    </div>

    <!-- Scherm 2: Google Maps - Olijfberg -->
    <div id="screen2" class="screen">
        <h2>üèîÔ∏è De Olijfberg</h2>
        <div id="map"></div>
        <p style="margin-top: 15px;">Dit is de plek waar Jezus vaak bad met zijn discipelen.</p>
    </div>

    <!-- Scherm 3: Bijbelverhaal -->
    <div id="screen3" class="screen">
        <h2>üìñ Bijbelverhaal</h2>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 20px;">
            <h3 style="color: #1e3799;">Jezus bidt op de Olijfberg</h3>
            <p>Jezus ging met zijn discipelen naar de Olijfberg. Hij zei: "Bid dat jullie niet in verleiding komen." Verderop knielde Hij neer en bad: "Vader, als U wilt, neem dan deze beker van mij weg. Maar laat niet wat ik wil, maar wat U wilt gebeuren." (Lucas 22:39-46)</p>
        </div>
    </div>

    <!-- Scherm 4: Rad van Fortuin + 6 Stellingen -->
    <div id="screen4" class="screen">
        <h2>üé° Rad van Fortuin</h2>
        <div class="wheel-container">
            <div id="wheel"></div>
            <div id="wheel-pointer">‚ñº</div>
        </div>
        <div id="wheel-number">Klik op rad om te draaien</div>
        <button onclick="spinWheel()" class="btn" style="background: #f6b93b; color: #1e3799;">Draai aan het rad!</button>
        
        <!-- 6 Stellingen (hidden tot rad draait) -->
        <div id="stellingen-container" style="display: none; margin-top: 30px;">
            <h3>Stellingen</h3>
            <div id="stellingen-lijst"></div>
        </div>
        
        <!-- Antwoorden overzicht -->
        <div id="antwoorden-overzicht" style="margin-top: 30px; display: none;">
            <h3>üìù Wat vinden de anderen?</h3>
            <div id="antwoorden-grid"></div>
        </div>
    </div>

    <!-- Scherm 5: Drag & Drop Gebeden -->
    <div id="screen5" class="screen">
        <h2>üôè Bij welk gebed hoort wie?</h2>
        <p style="text-align: center; margin-bottom: 15px;">Sleep de figuur naar het juiste gebed</p>
        <div class="drag-container" id="drag-drop-area"></div>
        <button onclick="checkMatches()" class="btn" style="background: #20bf6b;">Controleer</button>
        <div id="match-result" style="text-align: center; margin-top: 15px; font-weight: bold;"></div>
    </div>

    <!-- Scherm 6: Doolhof -->
    <div id="screen6" class="screen">
        <h2>üèÉ Discipelen naar Jezus</h2>
        <canvas id="maze-canvas" width="400" height="400"></canvas>
        <div class="controls">
            <button class="control-btn" onclick="moveDisciple('up')">‚Üë</button>
            <button class="control-btn" onclick="moveDisciple('left')">‚Üê</button>
            <button class="control-btn" onclick="moveDisciple('down')">‚Üì</button>
            <button class="control-btn" onclick="moveDisciple('right')">‚Üí</button>
        </div>
        <button onclick="resetGame()" class="btn" style="background: #e55039;">Opnieuw</button>
    </div>
</div>

<script type="module">
    // 1. Firebase imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // 2. Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54",
        authDomain: "schatgravers15maart2026.firebaseapp.com",
        databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "schatgravers15maart2026",
        appId: "1:30561512857:web:fcb7868b87d292d1c97708"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // 3. Globale variabelen
    let currentScreen = 1;
    let currentStelling = 0;
    const stellingen = [
        "Ik ben nooit bang.",
        "Als ik iets heel spannend vind om te gaan doen, hoop ik dat het niet doorgaat.",
        "Als ik zie dat iemand het moeilijk heeft, probeer ik hem of haar te helpen.",
        "Als ik het moeilijk heb of bang ben, ga ik bidden.",
        "Ik heb weleens kracht van God gekregen of de kracht van God gevoeld toen ik het moeilijk had.",
        "Ik zou graag meer willen weten over wat God precies wil."
    ];

    // 4. Login functie
    window.saveUser = () => {
        const name = document.getElementById('name-input').value.trim();
        if(name) {
            push(ref(db, 'users'), { name: name, timestamp: Date.now() });
            document.getElementById('name-input').value = "";
        }
    };

    // 5. Live feed van namen
    const nameList = document.getElementById('name-list');
    onValue(ref(db, 'users'), (snapshot) => {
        nameList.innerHTML = "";
        if(snapshot.exists()) {
            const users = snapshot.val();
            Object.values(users).reverse().forEach(user => {
                const div = document.createElement('div');
                div.className = 'name-tag';
                div.innerHTML = `üëã <b>${user.name}</b> doet mee!`;
                nameList.appendChild(div);
            });
        }
    });

    // 6. Scherm navigatie (voor beheerder)
    document.getElementById('next-screen-btn').addEventListener('click', () => {
        currentScreen = currentScreen < 6 ? currentScreen + 1 : 1;
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(`screen${currentScreen}`).classList.add('active');
        document.getElementById('screen-indicator').textContent = `Scherm ${currentScreen}/6`;
        
        // Sync scherm naar alle gebruikers via Firebase
        set(ref(db, 'currentScreen'), currentScreen);
    });

    // 7. Luister naar schermwijzigingen (voor alle gebruikers)
    onValue(ref(db, 'currentScreen'), (snapshot) => {
        if(snapshot.exists() && snapshot.val() !== currentScreen) {
            currentScreen = snapshot.val();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(`screen${currentScreen}`).classList.add('active');
        }
    });

    // 8. Google Maps initialisatie
    window.initMap = function() {
        const olijfberg = { lat: 31.7778, lng: 35.2456 };
        const map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: olijfberg,
            mapTypeId: 'satellite'
        });
        new google.maps.Marker({ position: olijfberg, map: map, title: 'Olijfberg' });
    };

    // 9. Rad van Fortuin
    window.spinWheel = () => {
        const wheel = document.getElementById('wheel');
        const spin = Math.floor(Math.random() * 360) + 720;
        wheel.style.transform = `rotate(${spin}deg)`;
        
        setTimeout(() => {
            const degrees = spin % 360;
            const segment = Math.floor(degrees / 60) + 1;
            currentStelling = segment;
            document.getElementById('wheel-number').textContent = `Stelling ${segment}: ${stellingen[segment-1]}`;
            
            // Toon stellingen container
            document.getElementById('stellingen-container').style.display = 'block';
            document.getElementById('antwoorden-overzicht').style.display = 'block';
            
            // Laad stellingen
            loadStellingen();
        }, 3000);
    };

    // 10. Stellingen laden met invoervelden
    function loadStellingen() {
        const container = document.getElementById('stellingen-lijst');
        container.innerHTML = '';
        
        stellingen.forEach((stelling, index) => {
            const card = document.createElement('div');
            card.className = 'stelling-card';
            card.innerHTML = `
                <strong>Stelling ${index+1}:</strong> ${stelling}
                <textarea id="antwoord-${index+1}" placeholder="Jouw gedachten..." rows="2"></textarea>
                <button onclick="saveAnswer(${index+1})" class="btn" style="padding: 10px;">Opslaan</button>
            `;
            container.appendChild(card);
        });
        
        // Laad antwoorden
        loadAnswers();
    }

    // 11. Antwoord opslaan
    window.saveAnswer = (stellingNr) => {
        const naam = localStorage.getItem('mijnNaam') || 'Anoniem';
        const antwoord = document.getElementById(`antwoord-${stellingNr}`).value.trim();
        if(antwoord) {
            push(ref(db, `antwoorden/stelling${stellingNr}`), { 
                naam: naam, 
                antwoord: antwoord,
                timestamp: Date.now()
            });
            document.getElementById(`antwoord-${stellingNr}`).value = '';
        }
    };

    // 12. Antwoorden live laden
    function loadAnswers() {
        const grid = document.getElementById('antwoorden-grid');
        
        for(let i = 1; i <= 6; i++) {
            const stellingDiv = document.createElement('div');
            stellingDiv.innerHTML = `<h4>Stelling ${i}</h4>`;
            const antwoordenDiv = document.createElement('div');
            antwoordenDiv.className = 'antwoorden-grid';
            antwoordenDiv.id = `antwoorden-stelling${i}`;
            stellingDiv.appendChild(antwoordenDiv);
            grid.appendChild(stellingDiv);
            
            onValue(ref(db, `antwoorden/stelling${i}`), (snapshot) => {
                const container = document.getElementById(`antwoorden-stelling${i}`);
                container.innerHTML = '';
                if(snapshot.exists()) {
                    Object.values(snapshot.val()).reverse().forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'antwoord-item';
                        div.innerHTML = `<b>${item.naam}:</b> ${item.antwoord}`;
                        container.appendChild(div);
                    });
                }
            });
        }
    }

    // 13. Drag & Drop data
    const gebedenMatch = [
        { figuur: "Abraham", gebed: "Ik bid dat er geen onschuldige mensen in de stad Sodom gedood zullen worden." },
        { figuur: "Agur", gebed: "Ik bid om altijd eerlijk te zijn en om precies te krijgen wat ik nodig heb, niet meer en niet minder." },
        { figuur: "David", gebed: "Ik bid om vergeving omdat ik iemand vermoord heb." },
        { figuur: "Elia", gebed: "Ik bid dat God mij antwoord geeft." },
        { figuur: "Gideon", gebed: "Ik vraag God om een teken zodat ik weet dat het waar is wat God heeft gezegd." },
        { figuur: "Hanna", gebed: "Ik bid om een zoon." },
        { figuur: "Jesaja", gebed: "Ik bid dat God vanuit de hemel naar ons kijkt." },
        { figuur: "Jezus", gebed: "Ik bid voor alle mensen die in mij zullen geloven als ze de boodschap van God horen." },
        { figuur: "Jezus", gebed: "Doe wat U zelf wilt, niet wat ik wil" },
        { figuur: "Jezus", gebed: "Vader, vergeef de mensen die mij doden, want ze weten niet wat ze doen" },
        { figuur: "Job", gebed: "Ik bid dat God aan mij denkt, want ik zal nooit meer gelukkig zijn." },
        { figuur: "Mozes", gebed: "Ik probeer God op andere gedachten te brengen." },
        { figuur: "Nehemia", gebed: "Ik doe in stilte een schietgebedje om hulp." },
        { figuur: "Paulus", gebed: "Ik vraag aan anderen om voor mij te bidden." },
        { figuur: "Salomo", gebed: "Ik bid om het verschil tussen goed en kwaad te zien." }
    ];

    // 14. Drag & Drop interface bouwen
    function initDragDrop() {
        const container = document.getElementById('drag-drop-area');
        container.innerHTML = `
            <div class="bijbel-figuren" id="figuren-container"></div>
            <div class="gebeden" id="gebeden-container"></div>
        `;
        
        const figurenContainer = document.getElementById('figuren-container');
        const gebedenContainer = document.getElementById('gebeden-container');
        
        // Figuren (drag sources)
        const figuren = [...new Set(gebedenMatch.map(g => g.figuur))];
        figuren.forEach(figuur => {
            const div = document.createElement('div');
            div.className = 'figuur-card';
            div.draggable = true;
            div.textContent = figuur;
            div.id = `fig-${figuur}`;
            div.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', figuur);
            });
            figurenContainer.appendChild(div);
        });
        
        // Gebeden (drop targets)
        gebedenMatch.sort(() => Math.random() - 0.5).forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'gebed-card';
            div.innerHTML = `<small>${item.gebed}</small><br><span id="match-${index}" style="color: #1e3799; font-weight: bold;"></span>`;
            div.addEventListener('dragover', (e) => e.preventDefault());
            div.addEventListener('drop', (e) => {
                e.preventDefault();
                const figuur = e.dataTransfer.getData('text/plain');
                if(figuur === item.figuur) {
                    document.getElementById(`match-${index}`).innerHTML = `‚úì ${figuur}`;
                    div.classList.add('matched');
                } else {
                    alert('Dat is niet de juiste figuur! Probeer opnieuw.');
                }
            });
            gebedenContainer.appendChild(div);
        });
    }

    // 15. Controleer matches
    window.checkMatches = () => {
        const matches = document.querySelectorAll('.matched').length;
        if(matches === gebedenMatch.length) {
            document.getElementById('match-result').innerHTML = 'üéâ Geweldig! Alles is goed!';
        } else {
            document.getElementById('match-result').innerHTML = `Je hebt ${matches} van de ${gebedenMatch.length} goed.`;
        }
    };

    // 16. Doolhof spel
    let maze = {
        width: 10,
        height: 10,
        disciple: { x: 0, y: 0 },
        jesus: { x: 9, y: 9 },
        guards: [{x: 3, y: 3}, {x: 5, y: 5}, {x: 7, y: 2}],
        bushes: [{x: 1, y: 1}, {x: 2, y: 4}, {x: 6, y: 7}, {x: 8, y: 3}]
    };

    function drawMaze() {
        const canvas = document.getElementById('maze-canvas');
        const ctx = canvas.getContext('2d');
        const cellSize = 40;
        
        ctx.clearRect(0, 0, 400, 400);
        
        // Teken grid
        ctx.strokeStyle = '#666';
        for(let i = 0; i <= 10; i++) {
            ctx.beginPath();
            ctx.moveTo(i * cellSize, 0);
            ctx.lineTo(i * cellSize, 400);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, i * cellSize);
            ctx.lineTo(400, i * cellSize);
            ctx.stroke();
        }
        
        // Teken struiken (groen)
        maze.bushes.forEach(b => {
            ctx.fillStyle = '#2ecc71';
            ctx.beginPath();
            ctx.arc(b.x * cellSize + cellSize/2, b.y * cellSize + cellSize/2, 15, 0, 2*Math.PI);
            ctx.fill();
        });
        
        // Teken wachters (rood)
        maze.guards.forEach(g => {
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(g.x * cellSize + 5, g.y * cellSize + 5, 30, 30);
        });
        
        // Teken discipel (blauw)
        ctx.fillStyle = '#3498db';
        ctx.beginPath();
        ctx.arc(maze.disciple.x * cellSize + cellSize/2, maze.disciple.y * cellSize + cellSize/2, 15, 0, 2*Math.PI);
        ctx.fill();
        
        // Teken Jezus (geel)
        ctx.fillStyle = '#f1c40f';
        ctx.beginPath();
        ctx.arc(maze.jesus.x * cellSize + cellSize/2, maze.jesus.y * cellSize + cellSize/2, 15, 0, 2*Math.PI);
        ctx.fill();
    }

    window.moveDisciple = (direction) => {
        const newPos = { ...maze.disciple };
        
        switch(direction) {
            case 'up': if(newPos.y > 0) newPos.y--; break;
            case 'down': if(newPos.y < 9) newPos.y++; break;
            case 'left': if(newPos.x > 0) newPos.x--; break;
            case 'right': if(newPos.x < 9) newPos.x++; break;
        }
        
        // Check collision met wachters
        const hitGuard = maze.guards.some(g => g.x === newPos.x && g.y === newPos.y);
        if(hitGuard) {
            alert('Oh nee! Een wachter heeft je gezien! Start opnieuw.');
            resetGame();
            return;
        }
        
        maze.disciple = newPos;
        drawMaze();
        
        // Check win
        if(maze.disciple.x === maze.jesus.x && maze.disciple.y === maze.jesus.y) {
            alert('üéâ Je hebt Jezus gevonden! Goed gedaan!');
        }
    };

    window.resetGame = () => {
        maze.disciple = { x: 0, y: 0 };
        drawMaze();
    };

    // 17. Initialisatie
    window.onload = () => {
        // Check of gebruiker al naam heeft
        const savedName = localStorage.getItem('mijnNaam');
        if(savedName) {
            document.getElementById('name-input').value = savedName;
        }
        
        // Sla naam op bij invoer
        document.getElementById('name-input').addEventListener('change', (e) => {
            localStorage.setItem('mijnNaam', e.target.value);
        });
        
        // Init drag & drop
        initDragDrop();
        
        // Teken doolhof
        drawMaze();
    };
</script>
</body>
</html>
