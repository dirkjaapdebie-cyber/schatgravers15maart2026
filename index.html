<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Schatgravers - Olijfberg Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: manipulation; }
        body { font-family: 'Fredoka', sans-serif; background: #0a3d62; min-height: 100vh; display: flex; justify-content: center; padding: 10px; }
        #app { width: 100%; max-width: 450px; position: relative; }
        .screen { display: none; background: white; border-radius: 30px; padding: 20px; min-height: 85vh; box-shadow: 0 20px 40px rgba(0,0,0,0.4); flex-direction: column; }
        .screen.active { display: flex; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        #nav-bar { background: #1e3799; color: white; padding: 12px; border-radius: 50px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3); gap: 10px; }
        .nav-buttons { display: flex; gap: 10px; }
        .nav-btn { background: #f6b93b; border: none; padding: 10px 20px; border-radius: 30px; font-weight: bold; cursor: pointer; color: #1e3799; font-size: 1rem; box-shadow: 0 3px 0 #b86d0c; }
        #reset-btn { background: #e55039; color: white; box-shadow: 0 3px 0 #b71540; }
        #screen-title { font-weight: 600; font-size: 1.2rem; }

        h2 { color: #1e3799; margin-bottom: 15px; text-align: center; }
        input, textarea { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 15px; font-family: 'Fredoka', sans-serif; font-size: 16px; }
        .btn { background: #1e3799; color: white; border: none; padding: 15px; border-radius: 50px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.1rem; margin: 10px 0; box-shadow: 0 4px #0a266e; }
        .btn:active { transform: translateY(4px); box-shadow: none; }

        /* Scherm 1 - Login */
        .live-feed { background: #f1f2f6; padding: 15px; border-radius: 20px; margin-top: 20px; max-height: 250px; overflow-y: auto; }
        .name-tag { background: white; padding: 12px; margin: 5px 0; border-radius: 10px; border-left: 5px solid #20bf6b; }

        /* Scherm 2 - Google Maps */
        #map-container { width: 100%; height: 350px; border-radius: 20px; overflow: hidden; border: 3px solid #ddd; margin: 10px 0; }

        /* Scherm 3 - Bijbelverhaal */
        .story-box { background: #fdf6e3; padding: 25px; border-radius: 20px; border-left: 8px solid #f6b93b; max-height: 500px; overflow-y: auto; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
        .story-text { line-height: 1.8; font-size: 1.1rem; }
        .story-text h3 { color: #1e3799; margin: 15px 0 10px; }

        /* Scherm 4 - Rad van Fortuin */
        .wheel-wrapper { position: relative; width: 280px; height: 280px; margin: 10px auto; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 5px solid #333; transition: transform 3s cubic-bezier(0.25, 0.1, 0.15, 1); background: conic-gradient(#f6b93b 0deg 60deg, #1e3799 60deg 120deg, #20bf6b 120deg 180deg, #e55039 180deg 240deg, #fa983a 240deg 300deg, #b71540 300deg 360deg); }
        #pointer { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); font-size: 40px; color: #333; z-index: 10; }
        .stelling-card { background: #f8f9fa; padding: 15px; border-radius: 15px; margin: 15px 0; border: 2px solid #1e3799; display: none; }
        .stelling-card.active { display: block; }
        .answers-feed { background: #f1f2f6; padding: 10px; border-radius: 10px; margin-top: 10px; max-height: 150px; overflow-y: auto; }
        .answer-item { background: white; padding: 5px 10px; margin: 3px 0; border-radius: 5px; border-left: 3px solid #20bf6b; font-size: 0.85rem; }
        #currentStelling { text-align: center; font-size: 1.3rem; margin: 15px 0; color: #1e3799; font-weight: bold; }

        /* Scherm 5 - LearningApps Embed */
        .learningapps-container { width: 100%; height: 500px; border-radius: 20px; overflow: hidden; border: 3px solid #1e3799; margin: 10px 0; }
        .learningapps-container iframe { width: 100%; height: 100%; border: 0; }

        /* Scherm 6 - Drag & Drop Gebeden */
        .drag-container { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .figuur-col, .gebed-col { background: #f1f2f6; padding: 15px; border-radius: 15px; max-height: 450px; overflow-y: auto; }
        .figuur-card { background: white; padding: 12px; margin: 8px 0; border-radius: 12px; border: 2px solid #1e3799; cursor: grab; text-align: center; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .figuur-card:active { cursor: grabbing; opacity: 0.8; }
        .gebed-card { background: #e3f2fd; padding: 12px; margin: 8px 0; border-radius: 12px; border: 2px dashed #1e3799; min-height: 70px; font-size: 0.85rem; transition: all 0.2s; }
        .gebed-card.matched { background: #c8e6c9; border: 2px solid #20bf6b; border-style: solid; }
        .match-badge { display: inline-block; background: #20bf6b; color: white; padding: 3px 10px; border-radius: 20px; font-size: 0.8rem; margin-top: 5px; }

        /* Scherm 7 - Woordveld */
        .word-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .letter-tile { background: #1e3799; color: white; font-size: 1.8rem; font-weight: bold; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.2s; }
        .letter-tile.selected { background: #f6b93b; color: #1e3799; transform: scale(0.95); }
        .target-word { font-size: 2rem; letter-spacing: 10px; text-align: center; margin: 20px 0; font-weight: bold; color: #1e3799; }

        /* Scherm 8 - Uitdagend Labyrinth */
        .maze-container { width: 100%; overflow-x: auto; -webkit-overflow-scrolling: touch; background: #2d5a27; border-radius: 20px; border: 4px solid #8B4513; }
        #mazeCanvas { width: 800px; height: 600px; display: block; margin: 0 auto; background: #2d5a27; }
        .maze-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; width: 200px; margin: 20px auto; }
        .maze-btn { background: #1e3799; color: white; border: none; width: 60px; height: 60px; border-radius: 30px; font-size: 2rem; cursor: pointer; box-shadow: 0 4px #0a266e; display: flex; align-items: center; justify-content: center; }
        .maze-btn:active { transform: translateY(4px); box-shadow: none; }
        .danger-indicator { background: #e74c3c; color: white; padding: 10px; border-radius: 50px; text-align: center; margin: 10px 0; font-weight: bold; animation: pulse 1s infinite; }
        .jesus-indicator { background: #f1c40f; color: #1e3799; padding: 10px; border-radius: 50px; text-align: center; margin: 10px 0; font-weight: bold; transition: all 0.5s; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        .maze-instructions { background: #f8f9fa; padding: 10px; border-radius: 10px; font-size: 0.9rem; margin: 10px 0; }
    </style>
</head>
<body>

<div id="app">
    <div id="nav-bar">
        <span id="screen-title">Inloggen</span>
        <div class="nav-buttons">
            <button class="nav-btn" id="reset-btn" onclick="resetAllData()">üîÑ Reset</button>
            <button class="nav-btn" onclick="nextScreen()">Volgende ‚ûî</button>
        </div>
    </div>

    <!-- Scherm 1: Inloggen -->
    <div id="screen1" class="screen active">
        <h2>üëã Welkom Schatgraver!</h2>
        <input type="text" id="playerName" placeholder="Jouw naam...">
        <button class="btn" onclick="login()">Naam opslaan</button>
        <div class="live-feed">
            <h4>üì± Live deelnemers:</h4>
            <div id="liveNames"></div>
        </div>
        <p style="text-align:center; color:#666; margin-top:10px;"><i>Wacht tot de leider op "Volgende" klikt</i></p>
    </div>

    <!-- Scherm 2: Google Maps Olijfberg -->
    <div id="screen2" class="screen">
        <h2>üèîÔ∏è De Olijfberg</h2>
        <div id="map-container">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3392.564547905878!2d35.24222221523456!3d31.778055581285215!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x150329eb965a396b%3A0x6a0531b7474a006e!2sMount%20of%20Olives!5e0!3m2!1sen!2snl!4v1647000000000" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
        <p style="margin-top:15px;">Dit is de Olijfberg, waar Jezus vaak kwam om te bidden.</p>
    </div>

    <!-- Scherm 3: Bijbelverhaal -->
    <div id="screen3" class="screen">
        <h2>üìñ Het verhaal</h2>
        <div class="story-box">
            <div class="story-text">
                <h3>Jezus bidt op de Olijfberg</h3>
                <p>Jezus ging met zijn leerlingen naar de Olijfberg, zoals Hij gewend was. Toen ze daar aangekomen waren, zei Hij tegen hen: "Bid dat jullie niet in verzoeking komen."</p>
                <p>Hijzelf ging een eindje verder, zo ver als een steenworp, en knielde neer. Hij bad: "Vader, als U wilt, neem dan deze beker van Mij weg. Maar laat niet Mijn wil gebeuren, maar de Uwe."</p>
                <p>Toen verscheen er een engel uit de hemel om Hem kracht te geven. In doodsangst bad Hij vuriger. Zijn zweet viel als druppels bloed op de grond.</p>
                <p>Na dit gebed stond Hij op en ging terug naar Zijn leerlingen. Hij vond hen slapend, want ze waren uitgeput van verdriet. Hij zei: "Waarom slapen jullie? Sta op en bid dat jullie niet in verzoeking komen."</p>
                <h3>Judas verraadt Jezus</h3>
                <p>Terwijl Hij nog sprak, kwam er een menigte. Judas, √©√©n van de twaalf, liep voorop. Hij naderde Jezus om Hem te kussen. Maar Jezus zei: "Judas, verraad je de Mensenzoon met een kus?"</p>
                <p>Toen de leerlingen zagen wat er ging gebeuren, vroegen ze: "Heer, zullen we met het zwaard terugslaan?" En √©√©n van hen sloeg de dienaar van de hogepriester en hakte zijn rechteroor af.</p>
                <p>Jezus zei: "Houd op! Genoeg!" En Hij raakte het oor aan en genas de man. Tegen de hogepriesters, tempelhoofden en oudsten die gekomen waren, zei Jezus: "Met zwaarden en knuppels bent u gekomen alsof Ik een misdadiger ben. Elke dag was Ik bij u in de tempel, maar u deed Mij niets. Maar dit is uw uur, de tijd dat de duisternis regeert."</p>
                <p style="font-style: italic; margin-top: 20px;">‚Äî Lucas 22:39-53</p>
            </div>
        </div>
    </div>

    <!-- Scherm 4: RAD VAN FORTUIN + 6 STELLINGEN -->
    <div id="screen4" class="screen">
        <h2>üé° Rad van Fortuin</h2>
        <div class="wheel-wrapper">
            <div id="wheel"></div>
            <div id="pointer">‚ñº</div>
        </div>
        <button class="btn" style="background:#f6b93b; color:#1e3799;" onclick="spinWheel()">üé≤ Draai aan het rad!</button>
        <div id="currentStelling"></div>
        <div id="stellingenContainer"></div>
    </div>

    <!-- Scherm 5: LearningApps Oefening -->
    <div id="screen5" class="screen">
        <h2>üéÆ Interactieve Oefening</h2>
        <div class="learningapps-container">
            <iframe src="https://learningapps.org/watch?v=pgg8jwj9a26" style="border:0px;width:100%;height:100%" allowfullscreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe>
        </div>
        <p style="text-align:center; margin-top:10px;">Maak de oefening op je eigen tempo!</p>
    </div>

    <!-- Scherm 6: Drag & Drop Gebeden -->
    <div id="screen6" class="screen">
        <h2>üôè Bij welk gebed hoort wie?</h2>
        <p style="text-align:center; margin-bottom:10px;">Sleep de bijbelfiguur naar het juiste gebed</p>
        <div class="drag-container" id="dragDropArea"></div>
        <button class="btn" style="background:#20bf6b;" onclick="checkAllMatches()">‚úÖ Controleer</button>
        <div id="dragResult" style="text-align:center; margin-top:15px; font-weight:bold;"></div>
    </div>

    <!-- Scherm 7: Woordveld -->
    <div id="screen7" class="screen">
        <h2>üî§ Zoek de woorden</h2>
        <p>Vorm woorden rond Pasen: <strong>GETSEMANE ‚Ä¢ OLIJFBERG ‚Ä¢ JEZUS ‚Ä¢ NARCISSEN ‚Ä¢ OPBLOEIEN</strong></p>
        <div class="target-word" id="targetDisplay"></div>
        <div class="word-grid" id="letterGrid"></div>
        <button class="btn" style="background:#20bf6b;" onclick="checkWord()">‚úÖ Controleer</button>
        <div id="wordResult" style="text-align:center; margin-top:10px;"></div>
    </div>

    <!-- Scherm 8: Uitdagend Labyrinth -->
    <div id="screen8" class="screen">
        <h2>üèÉ Het Grote Labyrinth</h2>
        <div class="danger-indicator" id="guardWarning">üö® 10 WACHTERS PATROUILLEREN! üö®</div>
        <div class="jesus-indicator" id="jesusDistance">‚úùÔ∏è Jezus wacht in het midden...</div>
        <div class="maze-instructions">
            <strong>üéØ Doel:</strong> Bereik Jezus (gele kruis) zonder gepakt te worden!<br>
            <strong>üåø Struiken</strong> zijn veilige schuilplaatsen.<br>
            <strong>üëÆ Wachters</strong> bewegen en achtervolgen je. Als Jezus dichtbij is, durven ze niet!
        </div>
        <div class="maze-container">
            <canvas id="mazeCanvas" width="800" height="600"></canvas>
        </div>
        <div class="maze-controls">
            <div></div><button class="maze-btn" onclick="moveDisciple(0,-1)">‚Üë</button><div></div>
            <button class="maze-btn" onclick="moveDisciple(-1,0)">‚Üê</button>
            <button class="maze-btn" onclick="moveDisciple(0,1)">‚Üì</button>
            <button class="maze-btn" onclick="moveDisciple(1,0)">‚Üí</button>
        </div>
        <button class="btn" style="background:#20bf6b;" onclick="finishMaze()">üèÅ Ik ben bij Jezus!</button>
        <button class="btn" style="background:#e55039;" onclick="resetMaze()">üîÑ Reset doolhof</button>
    </div>
</div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54",
        authDomain: "schatgravers15maart2026.firebaseapp.com",
        databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "schatgravers15maart2026",
        appId: "1:30561512857:web:fcb7868b87d292d1c97708"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentScreen = 1;
    let currentUser = '';
    let currentStelling = 0;
    let selectedLetters = [];
    let dragMatches = {};
    let gameActive = true;
    let gameStartTime;
    let guardInterval, jesusMoveInterval, distanceInterval;

    const stellingen = [
        "Ik ben nooit bang.",
        "Als ik iets heel spannend vind, hoop ik dat het niet doorgaat.",
        "Als ik zie dat iemand het moeilijk heeft, probeer ik te helpen.",
        "Als ik bang ben, ga ik bidden.",
        "Ik heb weleens kracht van God gevoeld.",
        "Ik zou graag meer willen weten over wat God precies wil."
    ];

    const gebedenMatch = [
        { figuur: "Abraham", gebed: "Ik bid dat er geen onschuldige mensen in de stad Sodom gedood zullen worden. (Genesis 18:22-33)" },
        { figuur: "Agur", gebed: "Ik bid om altijd eerlijk te zijn en om precies te krijgen wat ik nodig heb. (Spreuken 30:7-9)" },
        { figuur: "David", gebed: "Ik bid om vergeving omdat ik iemand vermoord heb. (Psalm 51:3-4)" },
        { figuur: "Elia", gebed: "Ik bid dat God mij antwoord geeft. (1 Koningen 18:37)" },
        { figuur: "Gideon", gebed: "Ik vraag God om een teken. (Rechters 6:36)" },
        { figuur: "Hanna", gebed: "Ik bid om een zoon. (1 Samuel 1:9-11)" },
        { figuur: "Jesaja", gebed: "Ik bid dat God vanuit de hemel naar ons kijkt. (Jesaja 63:15)" },
        { figuur: "Jezus", gebed: "Ik bid voor alle mensen die in mij zullen geloven. (Johannes 17:20)" },
        { figuur: "Jezus", gebed: "Doe wat U zelf wilt, niet wat ik wil. (Lucas 22:42)" },
        { figuur: "Jezus", gebed: "Vader, vergeef de mensen die mij doden. (Lucas 23:34)" },
        { figuur: "Job", gebed: "Ik bid dat God aan mij denkt. (Job 7:7)" },
        { figuur: "Mozes", gebed: "Ik probeer God op andere gedachten te brengen. (Exodus 32:11)" },
        { figuur: "Nehemia", gebed: "Ik doe in stilte een schietgebedje. (Nehemia 2:4)" },
        { figuur: "Paulus", gebed: "Ik vraag aan anderen om voor mij te bidden. (Romeinen 15:30)" },
        { figuur: "Salomo", gebed: "Ik bid om het verschil tussen goed en kwaad te zien. (1 Koningen 3:9)" }
    ];

    const words = ['GETSEMANE', 'OLIJFBERG', 'JEZUS', 'NARCISSEN', 'OPBLOEIEN'];
    let currentWord = '';

    // ========== NAVIGATIE ==========
    window.nextScreen = function() {
        document.getElementById(`screen${currentScreen}`).classList.remove('active');
        currentScreen = currentScreen < 8 ? currentScreen + 1 : 1;
        document.getElementById(`screen${currentScreen}`).classList.add('active');
        
        const titles = ['', 'Inloggen', 'Olijfberg', 'Verhaal', 'Rad van Fortuin', 'LearningApps', 'Gebeden', 'Woordveld', 'Doolhof'];
        document.getElementById('screen-title').innerText = titles[currentScreen];

        // Initialiseer schermen
        if(currentScreen === 4) initStellingen();
        if(currentScreen === 6) initDragDrop();
        if(currentScreen === 7) initWordGame();
        if(currentScreen === 8) {
            initMaze();
            if(guardInterval) clearInterval(guardInterval);
            guardInterval = setInterval(moveGuards, 600);
            if(jesusMoveInterval) clearInterval(jesusMoveInterval);
            jesusMoveInterval = setInterval(moveJesusCloser, 1500);
            if(distanceInterval) clearInterval(distanceInterval);
            distanceInterval = setInterval(updateJesusDistance, 1000);
        }
    };

    // ========== SCHERM 1: LOGIN ==========
    window.login = function() {
        const name = document.getElementById('playerName').value.trim();
        if(name) {
            currentUser = name;
            localStorage.setItem('spelerNaam', name);
            db.ref('spelers').push({ naam: name, tijd: Date.now() });
            document.getElementById('playerName').value = '';
            alert(`üëã Welkom ${name}! Je naam is opgeslagen. Wacht tot de leider verder gaat.`);
        } else { 
            alert('Voer je naam in!'); 
        }
    };

    db.ref('spelers').on('value', (snapshot) => {
        const list = document.getElementById('liveNames');
        if(list && snapshot.exists()) {
            list.innerHTML = '';
            Object.values(snapshot.val()).reverse().forEach(speler => {
                list.innerHTML += `<div class="name-tag">üëã <b>${speler.naam}</b> doet mee!</div>`;
            });
        }
    });

    // ========== SCHERM 4: RAD VAN FORTUIN ==========
    window.initStellingen = function() {
        const container = document.getElementById('stellingenContainer');
        if(!container) return;
        
        container.innerHTML = '';
        
        stellingen.forEach((s, i) => {
            const stellingDiv = document.createElement('div');
            stellingDiv.id = `stelling${i+1}`;
            stellingDiv.className = 'stelling-card';
            stellingDiv.innerHTML = `
                <strong>Stelling ${i+1}:</strong> ${s}
                <textarea id="antwoord${i+1}" placeholder="Jouw gedachten..." rows="2"></textarea>
                <button class="btn" style="padding:10px;" onclick="saveAnswer(${i+1})">üíæ Opslaan</button>
                <div class="answers-feed" id="feed${i+1}"></div>
            `;
            container.appendChild(stellingDiv);
        });
        
        // Live feeds voor elke stelling
        for(let i=1; i<=6; i++) {
            db.ref(`antwoorden/stelling${i}`).on('value', (snap) => {
                const feed = document.getElementById(`feed${i}`);
                if(feed) {
                    feed.innerHTML = '';
                    if(snap.exists()) {
                        Object.values(snap.val()).reverse().forEach(a => {
                            feed.innerHTML += `<div class="answer-item"><b>${a.naam}:</b> ${a.antwoord}</div>`;
                        });
                    }
                }
            });
        }
    };

    window.spinWheel = function() {
        const wheel = document.getElementById('wheel');
        const spin = Math.floor(Math.random() * 360) + 720;
        wheel.style.transform = `rotate(${spin}deg)`;
        
        setTimeout(() => {
            const segment = Math.floor((spin % 360) / 60) + 1;
            currentStelling = segment;
            document.getElementById('currentStelling').innerHTML = `üéØ <strong>Stelling ${segment}</strong> is actief!`;
            
            // Verberg alle stellingen, toon alleen de gekozen
            for(let i=1; i<=6; i++) {
                const el = document.getElementById(`stelling${i}`);
                if(el) el.classList.remove('active');
            }
            const activeEl = document.getElementById(`stelling${segment}`);
            if(activeEl) activeEl.classList.add('active');
        }, 3000);
    };

    window.saveAnswer = function(nr) {
        const antwoord = document.getElementById(`antwoord${nr}`).value.trim();
        if(antwoord && currentUser) {
            db.ref(`antwoorden/stelling${nr}`).push({
                naam: currentUser,
                antwoord: antwoord,
                tijd: Date.now()
            });
            document.getElementById(`antwoord${nr}`).value = '';
        } else {
            alert('Je moet eerst inloggen met je naam!');
        }
    };

    // ========== SCHERM 6: DRAG & DROP ==========
    window.initDragDrop = function() {
        const area = document.getElementById('dragDropArea');
        dragMatches = {};
        
        area.innerHTML = `
            <div class="figuur-col" id="figuurContainer"></div>
            <div class="gebed-col" id="gebedContainer"></div>
        `;
        
        const figuurContainer = document.getElementById('figuurContainer');
        const gebedContainer = document.getElementById('gebedContainer');
        
        const figuren = [...new Set(gebedenMatch.map(g => g.figuur))];
        figuren.forEach(figuur => {
            const div = document.createElement('div');
            div.className = 'figuur-card';
            div.draggable = true;
            div.innerText = figuur;
            div.id = `fig-${figuur.replace(/\s+/g, '')}`;
            div.ondragstart = (e) => {
                e.dataTransfer.setData('text/plain', figuur);
                e.dataTransfer.effectAllowed = 'move';
            };
            figuurContainer.appendChild(div);
        });

        const shuffled = [...gebedenMatch].sort(() => Math.random() - 0.5);
        shuffled.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'gebed-card';
            div.id = `gebed-${index}`;
            div.innerHTML = `
                <small>${item.gebed}</small>
                <div id="match-${index}" class="match-badge" style="display:none;">‚úì ${item.figuur}</div>
            `;
            
            div.ondragover = (e) => e.preventDefault();
            div.ondrop = (e) => {
                e.preventDefault();
                const figuur = e.dataTransfer.getData('text/plain');
                
                if(figuur === item.figuur) {
                    document.getElementById(`match-${index}`).style.display = 'inline-block';
                    div.classList.add('matched');
                    dragMatches[`gebed-${index}`] = figuur;
                    
                    const figElem = document.getElementById(`fig-${figuur.replace(/\s+/g, '')}`);
                    if(figElem) {
                        figElem.draggable = false;
                        figElem.style.opacity = '0.5';
                    }
                } else {
                    alert(`‚ùå Dit gebed is niet van ${figuur}. Probeer opnieuw!`);
                }
            };
            gebedContainer.appendChild(div);
        });
    };

    window.checkAllMatches = function() {
        const totalMatches = Object.keys(dragMatches).length;
        document.getElementById('dragResult').innerText = totalMatches === gebedenMatch.length 
            ? 'üéâ Geweldig! Alle gebeden zijn goed!'
            : `Je hebt ${totalMatches} van de ${gebedenMatch.length} goed.`;
    };

    // ========== SCHERM 7: WOORDVELD ==========
    window.initWordGame = function() {
        currentWord = words[Math.floor(Math.random() * words.length)];
        document.getElementById('targetDisplay').innerText = '_ '.repeat(currentWord.length);
        
        const grid = document.getElementById('letterGrid');
        grid.innerHTML = '';
        
        let letters = currentWord.split('');
        while(letters.length < 16) {
            letters.push(String.fromCharCode(65 + Math.floor(Math.random() * 26)));
        }
        letters.sort(() => Math.random() - 0.5);
        
        selectedLetters = [];
        letters.forEach(l => {
            const div = document.createElement('div');
            div.className = 'letter-tile';
            div.innerText = l;
            div.onclick = () => {
                div.classList.toggle('selected');
                if(div.classList.contains('selected')) {
                    selectedLetters.push(l);
                } else {
                    selectedLetters = selectedLetters.filter(s => s !== l);
                }
                updateWordDisplay();
            };
            grid.appendChild(div);
        });
    };

    function updateWordDisplay() {
        let display = '';
        for(let i=0; i<currentWord.length; i++) {
            if(selectedLetters.includes(currentWord[i])) {
                display += currentWord[i] + ' ';
            } else {
                display += '_ ';
            }
        }
        document.getElementById('targetDisplay').innerText = display;
    }

    window.checkWord = function() {
        const current = document.getElementById('targetDisplay').innerText.replace(/ /g, '');
        if(current === currentWord) {
            document.getElementById('wordResult').innerHTML = 'üéâ Goed gedaan!';
        } else {
            document.getElementById('wordResult').innerHTML = '‚ùå Nog niet goed';
        }
    };

    // ========== SCHERM 8: DOOLHOF ==========
    let maze = {
        disciple: {x: 1, y: 1},
        jesus: {x: 12, y: 7},
        walls: [
            {x: 3, y: 0}, {x: 3, y: 1}, {x: 3, y: 2}, {x: 3, y: 3},
            {x: 5, y: 2}, {x: 5, y: 3}, {x: 5, y: 4}, {x: 5, y: 5},
            {x: 7, y: 1}, {x: 7, y: 2}, {x: 7, y: 3}, {x: 7, y: 4}, {x: 7, y: 5}, {x: 7, y: 6},
            {x: 9, y: 3}, {x: 9, y: 4}, {x: 9, y: 5}, {x: 9, y: 6}, {x: 9, y: 7},
            {x: 11, y: 2}, {x: 11, y: 3}, {x: 11, y: 4}, {x: 11, y: 5},
            {x: 13, y: 4}, {x: 13, y: 5}, {x: 13, y: 6},
            {x: 2, y: 8}, {x: 2, y: 9}, {x: 2, y: 10},
            {x: 4, y: 7}, {x: 4, y: 8}, {x: 4, y: 9},
            {x: 6, y: 8}, {x: 6, y: 9}, {x: 6, y: 10},
            {x: 8, y: 9}, {x: 8, y: 10}, {x: 8, y: 11},
            {x: 10, y: 8}, {x: 10, y: 9}, {x: 10, y: 10},
            {x: 12, y: 9}, {x: 12, y: 10}, {x: 12, y: 11},
            {x: 14, y: 8}, {x: 14, y: 9}, {x: 14, y: 10}
        ],
        guards: [
            {x: 4, y: 2, speed: 1.2}, {x: 8, y: 4, speed: 1.1},
            {x: 12, y: 3, speed: 1.3}, {x: 3, y: 7, speed: 1.0},
            {x: 7, y: 9, speed: 1.2}, {x: 11, y: 8, speed: 1.1},
            {x: 13, y: 2, speed: 1.4}, {x: 5, y: 10, speed: 1.0},
            {x: 9, y: 11, speed: 1.2}, {x: 1, y: 5, speed: 1.3}
        ],
        bushes: [
            {x: 0, y: 2}, {x: 2, y: 4}, {x: 4, y: 1}, {x: 6, y: 3},
            {x: 8, y: 2}, {x: 10, y: 1}, {x: 12, y: 5}, {x: 14, y: 3},
            {x: 1, y: 8}, {x: 3, y: 10}, {x: 5, y: 7}, {x: 7, y: 11},
            {x: 9, y: 9}, {x: 11, y: 10}, {x: 13, y: 8}
        ]
    };

    window.initMaze = function() {
        gameActive = true;
        gameStartTime = Date.now();
        drawMaze();
    };

    function drawMaze() {
        const canvas = document.getElementById('mazeCanvas');
        if(!canvas) return;
        const ctx = canvas.getContext('2d');
        const cs = 40;
        
        ctx.clearRect(0, 0, 800, 600);
        
        ctx.strokeStyle = '#666';
        ctx.lineWidth = 0.5;
        for(let i=0; i<=20; i++) {
            ctx.beginPath();
            ctx.moveTo(i*cs, 0);
            ctx.lineTo(i*cs, 600);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, i*cs);
            ctx.lineTo(800, i*cs);
            ctx.stroke();
        }
        
        maze.walls.forEach(w => {
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(w.x*cs, w.y*cs, cs-1, cs-1);
        });
        
        maze.bushes.forEach(b => {
            ctx.fillStyle = '#2ecc71';
            ctx.beginPath();
            ctx.arc(b.x*cs + cs/2, b.y*cs + cs/2, 15, 0, 2*Math.PI);
            ctx.fill();
            ctx.fillStyle = '#27ae60';
            ctx.font = '20px Arial';
            ctx.fillText('üåø', b.x*cs + 10, b.y*cs + 28);
        });
        
        maze.guards.forEach(g => {
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(g.x*cs + 5, g.y*cs + 5, 30, 30);
            ctx.fillStyle = 'white';
            ctx.font = 'bold 20px Arial';
            ctx.fillText('üëÆ', g.x*cs + 10, g.y*cs + 30);
        });
        
        ctx.fillStyle = '#3498db';
        ctx.beginPath();
        ctx.arc(maze.disciple.x*cs + cs/2, maze.disciple.y*cs + cs/2, 15, 0, 2*Math.PI);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.font = 'bold 20px Arial';
        ctx.fillText('üë§', maze.disciple.x*cs + 12, maze.disciple.y*cs + 28);
        
        ctx.fillStyle = '#f1c40f';
        ctx.beginPath();
        ctx.arc(maze.jesus.x*cs + cs/2, maze.jesus.y*cs + cs/2, 18, 0, 2*Math.PI);
        ctx.fill();
        ctx.fillStyle = '#000';
        ctx.font = 'bold 22px Arial';
        ctx.fillText('‚úùÔ∏è', maze.jesus.x*cs + 8, maze.jesus.y*cs + 30);
    }

    function moveJesusCloser() {
        if(!gameActive) return;
        
        const elapsedSeconds = (Date.now() - gameStartTime) / 1000;
        const progress = Math.min(elapsedSeconds / 25, 0.8);
        
        const startX = 12, startY = 7;
        const targetX = 5, targetY = 4;
        
        let newX = Math.round(startX - (startX - targetX) * progress);
        let newY = Math.round(startY - (startY - targetY) * progress);
        
        const hitWall = maze.walls.some(w => w.x === newX && w.y === newY);
        if(!hitWall && (newX !== maze.jesus.x || newY !== maze.jesus.y)) {
            maze.jesus = {x: newX, y: newY};
            drawMaze();
        }
    }

    function updateJesusDistance() {
        if(!gameActive) return;
        
        const distance = Math.sqrt(
            Math.pow(maze.disciple.x - maze.jesus.x, 2) + 
            Math.pow(maze.disciple.y - maze.jesus.y, 2)
        );
        
        const indicator = document.getElementById('jesusDistance');
        if(distance < 4) {
            indicator.innerHTML = '‚úùÔ∏è Jezus is vlakbij! ‚úùÔ∏è';
            indicator.style.background = '#f1c40f';
        } else if(distance < 8) {
            indicator.innerHTML = '‚úùÔ∏è Jezus komt dichterbij... ‚úùÔ∏è';
            indicator.style.background = '#f39c12';
        } else {
            indicator.innerHTML = '‚úùÔ∏è Jezus is nog ver weg... ‚úùÔ∏è';
            indicator.style.background = '#e67e22';
        }
    }

    window.moveDisciple = function(dx, dy) {
        if(!gameActive) return;
        
        let nx = maze.disciple.x + dx;
        let ny = maze.disciple.y + dy;
        
        if(nx >= 0 && nx < 20 && ny >= 0 && ny < 15) {
            const hitWall = maze.walls.some(w => w.x === nx && w.y === ny);
            if(!hitWall) {
                maze.disciple = {x: nx, y: ny};
            }
        }
        drawMaze();
        checkGuardCollision();
    };

    function moveGuards() {
        if(!gameActive) return;
        
        maze.guards = maze.guards.map(guard => {
            const distanceToJesus = Math.sqrt(
                Math.pow(guard.x - maze.jesus.x, 2) + 
                Math.pow(guard.y - maze.jesus.y, 2)
            );
            
            let dx = maze.disciple.x - guard.x;
            let dy = maze.disciple.y - guard.y;
            
            let newX = guard.x;
            let newY = guard.y;
            
            if(distanceToJesus < 4) {
                const fearX = guard.x - (maze.jesus.x - guard.x) * 0.4;
                const fearY = guard.y - (maze.jesus.y - guard.y) * 0.4;
                newX = Math.round(fearX);
                newY = Math.round(fearY);
            } else {
                if(Math.abs(dx) > Math.abs(dy)) {
                    newX = guard.x + (dx > 0 ? 1 : -1);
                } else {
                    newY = guard.y + (dy > 0 ? 1 : -1);
                }
            }
            
            if(newX >= 0 && newX < 20 && newY >= 0 && newY < 15) {
                const hitWall = maze.walls.some(w => w.x === newX && w.y === newY);
                const onBush = maze.bushes.some(b => b.x === newX && b.y === newY);
                if(!hitWall && !onBush) {
                    return {x: newX, y: newY, speed: guard.speed};
                }
            }
            return guard;
        });
        
        drawMaze();
        checkGuardCollision();
    }

    function checkGuardCollision() {
        const caught = maze.guards.some(g => 
            Math.abs(g.x - maze.disciple.x) < 1 && Math.abs(g.y - maze.disciple.y) < 1
        );
        
        if(caught) {
            gameActive = false;
            document.getElementById('guardWarning').innerHTML = 'üòµ GEPAKT! Je begint opnieuw...';
            document.getElementById('guardWarning').style.background = '#c0392b';
            setTimeout(() => {
                resetMaze();
                document.getElementById('guardWarning').innerHTML = 'üö® 10 WACHTERS PATROUILLEREN! üö®';
                document.getElementById('guardWarning').style.background = '#e74c3c';
            }, 2000);
        }
    }

    window.finishMaze = function() {
        const distance = Math.sqrt(
            Math.pow(maze.disciple.x - maze.jesus.x, 2) + 
            Math.pow(maze.disciple.y - maze.jesus.y, 2)
        );
        
        if(distance < 2) {
            gameActive = false;
            clearInterval(guardInterval);
            clearInterval(jesusMoveInterval);
            clearInterval(distanceInterval);
            
            const elapsedSeconds = ((Date.now() - gameStartTime) / 1000).toFixed(1);
            alert(`üéâ GEWELDIG! Je hebt Jezus gevonden in ${elapsedSeconds} seconden!`);
            
            if(currentUser) {
                db.ref('leaderboard/maze').push({
                    naam: currentUser,
                    tijd: parseFloat(elapsedSeconds)
                });
            }
        } else {
            alert(`Je bent nog ${Math.round(distance)} stappen van Jezus verwijderd!`);
        }
    };

    window.resetMaze = function() {
        maze.disciple = {x: 1, y: 1};
        maze.jesus = {x: 12, y: 7};
        maze.guards = [
            {x: 4, y: 2, speed: 1.2}, {x: 8, y: 4, speed: 1.1},
            {x: 12, y: 3, speed: 1.3}, {x: 3, y: 7, speed: 1.0},
            {x: 7, y: 9, speed: 1.2}, {x: 11, y: 8, speed: 1.1},
            {x: 13, y: 2, speed: 1.4}, {x: 5, y: 10, speed: 1.0},
            {x: 9, y: 11, speed: 1.2}, {x: 1, y: 5, speed: 1.3}
        ];
        gameActive = true;
        gameStartTime = Date.now();
        drawMaze();
    };

    // ========== RESET ALLES ==========
    window.resetAllData = function() { 
        if(confirm("‚ö†Ô∏è Alles wissen?\n\nAlle namen en antwoorden worden gewist!")) { 
            db.ref('spelers').remove();
            db.ref('antwoorden').remove();
            db.ref('leaderboard').remove();
            
            clearInterval(guardInterval);
            clearInterval(jesusMoveInterval);
            clearInterval(distanceInterval);
            
            currentScreen = 1;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById('screen1').classList.add('active');
            document.getElementById('screen-title').innerText = 'Inloggen';
            
            document.getElementById('playerName').value = '';
            localStorage.removeItem('spelerNaam');
            
            if(typeof resetMaze === 'function') resetMaze();
        }
    };
</script>
</body>
</html>
