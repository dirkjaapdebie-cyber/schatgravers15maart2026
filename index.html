<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schatgravers 15 Maart 2026 | Live Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Black+Ops+One&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #1e3799; --accent: #eb4d4b; --bg: #0a3d62; --gold: #f1c40f; --neon: #00d2ff; }
        body { font-family: 'Fredoka', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; overflow-x: hidden; }
        
        /* ADMIN PANEEL */
        #admin-panel { display: none; background: #000; padding: 15px; border: 3px solid var(--gold); border-radius: 15px; margin-bottom: 20px; position: sticky; top: 0; z-index: 1000; }
        .admin-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; }
        .btn-nav { background: #333; color: white; padding: 8px 2px; border-radius: 5px; border: 1px solid #555; cursor: pointer; font-size: 0.6rem; font-weight: bold; }
        .btn-nav.active-nav { background: var(--gold); color: black; }

        /* SCHERMEN */
        .screen { display: none; width: 100%; max-width: 600px; margin: 0 auto; text-align: center; }
        .screen.active { display: block; }
        .card { background: white; color: #333; padding: 20px; border-radius: 20px; margin: 15px 0; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        .scroll-area { height: 350px; overflow-y: auto; text-align: left; padding: 10px; border: 1px solid #eee; border-radius: 10px; white-space: pre-wrap; }

        /* WHEEL & FEED */
        #live-feed { height: 180px; overflow-y: auto; background: #eee; border-radius: 10px; padding: 10px; display: flex; flex-direction: column-reverse; }
        .feed-msg { background: white; padding: 8px; margin-bottom: 5px; border-radius: 8px; border-left: 4px solid var(--primary); font-size: 0.8rem; text-align: left; color: #333; }

        /* BUTTONS */
        .btn { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; }
        .btn-reset { background: #eb4d4b !important; color: white; margin-top: 10px; }
        input { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid #ddd; margin-bottom: 10px; box-sizing: border-box; }
    </style>
</head>
<body>

    <div id="admin-panel">
        <div class="admin-grid">
            <button class="btn-nav" id="nav1" onclick="setStep(1)">1. Lobby</button>
            <button class="btn-nav" id="nav2" onclick="setStep(2)">2. Kaart</button>
            <button class="btn-nav" id="nav3" onclick="setStep(3)">3. Verhaal</button>
            <button class="btn-nav" id="nav4" onclick="setStep(4)">4. Gebeden</button>
            <button class="btn-nav" id="nav5" onclick="setStep(5)">5. Wheel</button>
            <button class="btn-nav" id="nav6" onclick="setStep(6)">6. Puzzel</button>
            <button class="btn-nav" id="nav7" onclick="setStep(7)">7. Maze</button>
            <button class="btn-nav btn-reset" onclick="hardReset()">HARD RESET</button>
        </div>
        <button class="btn-nav" style="width:100%; margin-top:8px; background:var(--gold); color:black" onclick="spinWheel()">NIEUWE STELLING DRAAIEN</button>
    </div>

    <div id="screen-1" class="screen active">
        <h1 style="font-family:'Black Ops One'; font-size:3rem; color:var(--gold); margin-bottom:0;">SQUAD</h1>
        <div id="login-box" class="card">
            <input type="text" id="name-in" placeholder="TYP JE NAAM...">
            <button onclick="join()" class="btn">START DE LES</button>
        </div>
        <div class="card" style="background:rgba(255,255,255,0.1); border:1px solid var(--neon);">
            <p style="color:var(--neon); font-size:0.8rem; font-weight:bold;">SQUAD MEMBERS ONLINE:</p>
            <div id="lobby-list" style="display:flex; flex-wrap:wrap; gap:5px; justify-content:center;"></div>
        </div>
    </div>

    <div id="screen-2" class="screen">
        <h2 style="color:var(--gold)">VIRTUEEL OP DE OLIJFBERG</h2>
        <div class="card" style="padding:0; height:450px; overflow:hidden;">
            <iframe width="100%" height="100%" frameborder="0" src="http://googleusercontent.com/maps.google.com/8"></iframe>
        </div>
    </div>

    <div id="screen-3" class="screen">
        <div class="card">
            <div class="scroll-area" id="story-content">
                Jezus bidt op de Olijfberg... (enzovoort)
            </div>
        </div>
    </div>

    <div id="screen-5" class="screen">
        <div id="stelling-box" class="card" style="font-weight:bold; color:var(--primary); font-size:1.2rem; border:4px solid var(--neon); min-height:60px;">
            De stelling verschijnt hier...
        </div>
        <div class="card">
            <input type="text" id="opinion-in" placeholder="Wat vind jij hiervan?">
            <button onclick="sendOpinion()" class="btn">VERSTUREN</button>
            <div id="live-feed"></div>
        </div>
    </div>

    <script>
        // FIREBASE INITIALISATIE
        const firebaseConfig = { 
            apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54", 
            databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app", 
            projectId: "schatgravers15maart2026" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let myName = "", isAdmin = false, currentStep = 1;

        // --- DE REFRESH & RESET LOGICA ---

        // 1. Forceer een frisse start bij laden van de pagina
        window.onload = function() {
            console.log("Systeem ververst...");
            // We checken direct waar de groep is
            db.ref('currentStep').once('value').then(snap => {
                updateView(snap.val() || 1);
            });
        };

        // 2. Hard Reset functie (voor Dirkjaap)
        function hardReset() {
            if(confirm("DIT ZET IEDEREEN TERUG NAAR DE LOBBY. WEET JE HET ZEKER?")) {
                db.ref('/').update({
                    currentStep: 1,
                    activeStelling: "Klaar voor de start?",
                    opinions: null // Wist ook de oude chatberichten!
                });
                location.reload(); // Ververs je eigen scherm
            }
        }

        // 3. De Master Sync (Luisteren naar veranderingen)
        db.ref('currentStep').on('value', snap => {
            updateView(snap.val() || 1);
        });

        function updateView(step) {
            currentStep = step;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const activeScreen = document.getElementById('screen-' + step);
            if(activeScreen) activeScreen.classList.add('active');
            
            // Highlight admin knop
            document.querySelectorAll('.btn-nav').forEach(b => b.classList.remove('active-nav'));
            if(document.getElementById('nav'+step)) document.getElementById('nav'+step).classList.add('active-nav');

            // Laad stelling ALLEEN als we op scherm 5 zijn
            if(step === 5) {
                db.ref('activeStelling').on('value', snap => {
                    document.getElementById('stelling-box').innerText = snap.val() || "Wachten op de volgende stelling...";
                });
            }
        }

        // --- OVERIGE FUNCTIES ---

        function setStep(n) { if(isAdmin) db.ref('currentStep').set(n); }

        function join() {
            const n = document.getElementById('name-in').value.trim();
            if(n) {
                myName = n;
                db.ref('players').push(n);
                document.getElementById('login-box').style.display='none';
                if(n.toLowerCase() === 'dirkjaap') {
                    isAdmin = true;
                    document.getElementById('admin-panel').style.display = 'block';
                }
            }
        }

        db.ref('players').on('value', snap => {
            const l = document.getElementById('lobby-list'); l.innerHTML = "";
            if(snap.exists()) {
                Object.values(snap.val()).forEach(v => {
                    l.innerHTML += `<span class="badge" style="background:var(--neon); padding:5px 10px; border-radius:10px; color:black; margin:2px;">${v}</span>`;
                });
            }
        });

        const stellingen = [
            "1 Ik ben nooit bang.", 
            "2 Als het spannend wordt, hoop ik dat het niet doorgaat.", 
            "3 Ik help anderen die het moeilijk hebben.", 
            "4 Als ik bang ben, ga ik bidden.", 
            "5 Ik heb de kracht van God weleens gevoeld.", 
            "6 Ik wil graag weten wat God van mij wil."
        ];

        function spinWheel() {
            const s = stellingen[Math.floor(Math.random()*stellingen.length)];
            db.ref('activeStelling').set(s);
        }

        function sendOpinion() {
            const t = document.getElementById('opinion-in').value.trim();
            if(t) {
                db.ref('opinions').push({n: myName || "Anoniem", t: t});
                document.getElementById('opinion-in').value = "";
            }
        }

        db.ref('opinions').limitToLast(15).on('value', snap => {
            const f = document.getElementById('live-feed'); f.innerHTML = "";
            snap.forEach(c => {
                f.innerHTML += `<div class="feed-msg"><b>${c.val().n}:</b> ${c.val().t}</div>`;
            });
        });

    </script>
</body>
</html>
