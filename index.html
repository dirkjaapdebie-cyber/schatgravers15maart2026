<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Schatgravers V40 - Olijfberg</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e3799; --accent: #eb4d4b; --success: #20bf6b; --bg: #0a3d62; --gold: #f1c40f; }
        body, html { margin: 0; padding: 0; height: 100vh; font-family: 'Fredoka', sans-serif; overflow: hidden; background: var(--bg); color: #333; }
        .bg-fixed { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(10, 61, 98, 0.85), rgba(10, 61, 98, 0.85)), url('schatgravers15maart.jpg'); background-size: cover; z-index: -1; }
        .container { display: none; height: 100vh; padding: 15px; box-sizing: border-box; flex-direction: column; align-items: center; overflow-y: auto; padding-bottom: 110px; }
        
        /* STORY STYLE MET SCROLLBAR */
        .story-container { 
            background: #fdfbf7; 
            padding: 20px; 
            border-radius: 12px; 
            width: 90%; 
            max-width: 550px; 
            border-top: 6px solid var(--gold); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            max-height: 70vh; /* Zorgt dat het venster niet van het scherm afvalt */
        }
        .story-scroll-area {
            overflow-y: auto;
            padding-right: 10px;
            margin-top: 10px;
            text-align: left;
        }
        /* Custom scrollbar voor de look */
        .story-scroll-area::-webkit-scrollbar { width: 6px; }
        .story-scroll-area::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        .story-content { font-family: 'Lora', serif; font-size: 1.05rem; line-height: 1.6; color: #2c3e50; }
        
        /* DOOLHOF STYLE */
        #maze-container { position: relative; background: #2d5a27; border: 4px solid var(--gold); border-radius: 10px; padding: 0; line-height: 0; margin-top: 5px; user-select: none; }
        .maze-row { display: flex; }
        .cell { width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; box-sizing: border-box; font-size: 11px; font-weight: bold; }
        .wall { background: #1a3a16; border: 1px solid #142d11; }
        .path { background: #4a7c44; color: rgba(255,255,255,0.15); }
        .letter-cell { color: white; text-shadow: 1px 1px 2px black; z-index: 5; }
        
        #player { position: absolute; width: 22px; height: 22px; transition: all 0.1s; z-index: 10; background-image: url('judas.png'); background-size: contain; background-repeat: no-repeat; background-position: center; border-radius: 50%; }
        .target-img { width: 20px; height: 20px; object-fit: contain; }

        .navigation-panel { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 5px; z-index: 10000; background: rgba(0,0,0,0.9); padding: 8px; border-radius: 40px; }
        .nav-btn { width: 36px; height: 36px; border-radius: 50%; border: 1px solid white; background: transparent; color: white; cursor: pointer; font-size: 0.85rem; font-weight: bold; }
        .nav-btn.active { background: white; color: var(--bg); }
        
        .vault { background: white; padding: 8px; border-radius: 10px; font-size: 0.65rem; min-height: 50px; width: 100%; box-sizing: border-box; }
        .vault.active { border: 3px solid var(--gold); }
        .btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; }
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
        .control-btn { width: 55px; height: 55px; background: white; border: none; border-radius: 12px; font-size: 1.5rem; }
    </style>
</head>
<body>

<div class="bg-fixed"></div>

<div id="phase-1" class="container" style="display:flex;">
    <div style="background:white; padding:30px; border-radius:20px; text-align:center; width:90%; max-width:400px;">
        <h1>Schatgravers</h1>
        <input type="text" id="name-in" placeholder="Jouw naam..." style="width:100%; padding:12px; margin-bottom:10px; border-radius:10px; border:1px solid #ddd; box-sizing: border-box;">
        <button onclick="sendName()" class="btn">DOE MEE</button>
        <div id="display-names-list" style="margin-top:20px;"></div>
    </div>
</div>

<div id="phase-3" class="container">
    <div class="story-container">
        <h3 style="color:var(--primary); margin:0; text-align:center;">Lukas 22:39-53</h3>
        <div class="story-scroll-area">
            <div class="story-content">
                <p><strong>Jezus bidt op de Olijfberg</strong><br>
                Jezus ging de stad uit. Hij ging naar de Olijfberg, zoals altijd. De leerlingen gingen met hem mee. Toen ze op de berg waren, zei Jezus: ‚ÄòBid God om kracht, zodat je geen verkeerde keuze maakt.‚Äô</p>
                <p>Daarna liep hij zelf een stukje verder. Hij knielde en begon te bidden: ‚ÄòVader, als u het wilt, houd dan dit zware lijden bij mij weg! Maar doe wat u zelf wilt, niet wat ik wil.‚Äô</p>
                <p>Toen kwam er een engel uit de hemel om Jezus kracht te geven. Jezus was bang en ging steeds harder bidden. Zijn zweet viel in grote druppels op de grond. Het leken wel druppels bloed.</p>
                <p>Toen Jezus klaar was met bidden, stond Hij op en ging naar zijn leerlingen. Die waren van verdriet in slaap gevallen. Jezus zei: ‚ÄòWaarom slapen jullie? Bid God om kracht, zodat je geen verkeerde keuze maakt.‚Äô</p>
                <hr style="border: 0; border-top: 1px solid #ddd; margin: 15px 0;">
                <p><strong>Judas verraadt Jezus</strong><br>
                Terwijl Jezus dat zei, kwam er een groep mannen aan. Judas, √©√©n van de twaalf leerlingen, liep voorop. Hij ging naar Jezus toe en groette hem met een kus. Maar Jezus zei: ‚ÄòJudas, verraad je de Mensenzoon met een kus?‚Äô</p>
                <p>Toen de leerlingen begrepen wat er ging gebeuren, vroegen ze: ‚ÄòHeer, zullen we onze zwaarden pakken?‚Äô En √©√©n van de leerlingen pakte zijn zwaard en sloeg de knecht van de hogepriester. Hij sloeg zijn rechteroor eraf. Maar Jezus zei: ‚ÄòStop, genoeg!‚Äô En hij pakte het oor en maakte de man weer beter.</p>
                <p>Er waren priesters, officieren van de tempel en leiders van het volk meegekomen om Jezus gevangen te nemen. Jezus zei tegen hen: ‚ÄòJullie zijn hier gekomen met zwaarden en stokken. Alsof ik een gevaarlijke misdadiger ben! Nu laat de duisternis haar macht zien.‚Äô</p>
            </div>
        </div>
    </div>
</div>

<div id="phase-6" class="container">
    <div style="background:white; padding:15px; border-radius:15px; text-align:center; width:95%; max-width:500px;">
        <div id="dice-display" style="font-size:3.5rem;">üé≤</div>
        <p id="stelling-text" style="font-weight:bold; color:var(--primary);"></p>
        <button onclick="triggerRoll()" class="btn" style="background:var(--gold); color:black;">DOBBELEN</button>
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%; max-width:500px; margin-top:10px;">
        <div class="vault" id="v-1"><b>1. ANGST</b><div id="l1"></div></div>
        <div class="vault" id="v-2"><b>2. KEUZES</b><div id="l2"></div></div>
        <div class="vault" id="v-3"><b>3. ENGELEN</b><div id="l3"></div></div>
        <div class="vault" id="v-4"><b>4. BIDDEN</b><div id="l4"></div></div>
        <div class="vault" id="v-5"><b>5. ALLEEN</b><div id="l5"></div></div>
        <div class="vault" id="v-6"><b>6. HERSTEL</b><div id="l6"></div></div>
    </div>
    <input type="text" id="thought-in" placeholder="Gedachte..." style="width:100%; padding:10px; margin-top:10px; border-radius:10px; border:none;">
    <button onclick="sendThought()" class="btn" style="background:var(--success); margin-top:5px;">STUUR</button>
</div>

<div id="phase-9" class="container">
    <h2 style="color:white; margin:0;">De Olijfberg</h2>
    <div id="word-display" style="background:white; padding:8px; border-radius:10px; margin:5px; font-weight:bold; letter-spacing:4px; color:var(--accent);">_______</div>
    <div id="maze-container"><div id="player"></div><div id="maze-grid"></div></div>
    <div class="controls">
        <div></div><button class="control-btn" onclick="movePlayer(0, -1)">‚Üë</button><div></div>
        <button class="control-btn" onclick="movePlayer(-1, 0)">‚Üê</button>
        <button class="control-btn" onclick="movePlayer(0, 1)">‚Üì</button>
        <button class="control-btn" onclick="movePlayer(1, 0)">‚Üí</button>
    </div>
    <button onclick="resetNames()" class="btn" style="background:var(--accent); margin-top:15px; font-size:0.7rem; width:160px;">WIS NAMEN (EINDE)</button>
</div>

<div class="navigation-panel">
    <button class="nav-btn" id="btn-p1" onclick="navTo('p1')">1</button>
    <button class="nav-btn" id="btn-p3" onclick="navTo('p3')">3</button>
    <button class="nav-btn" id="btn-p6" onclick="navTo('p6')">6</button>
    <button class="nav-btn" id="btn-p9" onclick="navTo('p9')">9</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = { apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54", authDomain: "schatgravers15maart2026.firebaseapp.com", databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app", projectId: "schatgravers15maart2026", appId: "1:30561512857:web:fcb7868b87d292d1c97708" };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    window.navTo = (p) => set(ref(db, 'currentPhase'), p);
    window.sendName = () => { const v = document.getElementById('name-in').value; if(v) push(ref(db, 'names'), v); document.getElementById('name-in').value=''; };
    window.resetNames = () => { if(confirm("Namen wissen?")) remove(ref(db, 'names')); };
    window.triggerRoll = () => set(ref(db, 'dice'), Math.floor(Math.random()*6)+1);
    window.sendThought = () => { const v = document.getElementById('thought-in').value; if(v) push(ref(db, 'vaults/'+curDice), v); document.getElementById('thought-in').value=''; };

    let curDice = 1;
    const stellingen = ["1. Ben je weleens doodsbang?", "2. Maak je weleens een verkeerde keuze?", "3. Heb je weleens hulp gekregen van een 'engel'?", "4. Bid jij om kracht?", "5. Voel je je weleens alleen?", "6. Kun jij iemand vergeven?"];

    onValue(ref(db, 'currentPhase'), s => {
        const p = s.val() || 'p1';
        document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
        document.getElementById('phase-' + p.replace('p','')).style.display = 'flex';
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-'+p).classList.add('active');
        if(p === 'p9') initMaze();
    });

    onValue(ref(db, 'dice'), s => {
        curDice = s.val() || 1;
        document.getElementById('dice-display').innerText = ["‚öÄ","‚öÅ","‚öÇ","‚öÉ","‚öÑ","‚öÖ"][curDice-1];
        document.getElementById('stelling-text').innerText = stellingen[curDice-1];
        document.querySelectorAll('.vault').forEach(v => v.classList.remove('active'));
        document.getElementById('v-'+curDice).classList.add('active');
    });

    onValue(ref(db, 'names'), s => {
        const d = document.getElementById('display-names-list'); d.innerHTML = '';
        if(s.val()) Object.values(s.val()).forEach(n => d.innerHTML += `<span class="name-tag">${n}</span>`);
    });

    onValue(ref(db, 'vaults'), s => {
        for(let i=1; i<=6; i++){
            const v = document.getElementById('l'+i); if(v) v.innerHTML = '';
            if(s.val() && s.val()[i]) Object.values(s.val()[i]).slice(-1).forEach(t => v.innerHTML += `<div style="font-size:0.55rem; color:#444;">‚Ä¢ ${t}</div>`);
        }
    });

    const mazeData = [
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,"Z",0,1,0,0,0,0,"B",0,0,1],
        [1,0,1,1,1,0,1,0,1,1,1,1,1,0,1],
        [1,"V",1,0,0,0,0,0,"J",0,1,0,0,"S",1],
        [1,0,1,0,1,1,1,0,1,0,1,0,1,1,1],
        [1,"U",0,0,1,0,0,"E",1,0,0,0,"Z",0,1],
        [1,1,1,0,1,0,1,1,1,0,1,1,1,0,1],
        [1,0,0,"R",0,0,1,"‚úùÔ∏è",1,0,"R",0,0,0,1],
        [1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],
        [1,"A",0,0,0,"B",0,0,0,0,0,"J",0,"A",1],
        [1,0,1,1,1,1,1,0,1,1,1,1,1,0,1],
        [1,"S",0,0,0,"D",0,0,"U",0,0,0,"Z",0,1],
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ];

    let pPos = { x: 1, y: 1 };
    let coll = "";
    const goal = "VERRAAD";

    function initMaze() {
        const g = document.getElementById('maze-grid'); g.innerHTML = '';
        mazeData.forEach((row, y) => {
            const rDiv = document.createElement('div'); rDiv.className = 'maze-row';
            row.forEach((cell, x) => {
                const cDiv = document.createElement('div');
                cDiv.className = 'cell ' + (cell === 1 ? 'wall' : 'path');
                if(cell === "‚úùÔ∏è") cDiv.innerHTML = `<img src="jezus.png" class="target-img">`;
                else if(typeof cell === 'string' && cell !== "0") { cDiv.innerText = cell; cDiv.classList.add('letter-cell'); }
                rDiv.appendChild(cDiv);
            });
            g.appendChild(rDiv);
        });
        updateP();
    }

    window.movePlayer = (dx, dy) => {
        const nx = pPos.x + dx; const ny = pPos.y + dy;
        if(mazeData[ny] && mazeData[ny][nx] !== 1) {
            pPos.x = nx; pPos.y = ny;
            const val = mazeData[ny][nx];
            if(typeof val === 'string' && val !== "‚úùÔ∏è" && val !== "0") {
                if(val === goal[coll.length]) coll += val; else coll = "";
                document.getElementById('word-display').innerText = coll.padEnd(7, "_");
            }
            if(val === "‚úùÔ∏è") {
                if(coll === goal) alert("Gevonden.");
                else { alert("Verkeerd pad."); coll = ""; pPos = {x:1, y:1}; document.getElementById('word-display').innerText = "_______"; }
            }
            updateP();
        }
    };

    function updateP() {
        const p = document.getElementById('player');
        p.style.left = (pPos.x * 22 + 4) + 'px';
        p.style.top = (pPos.y * 22 + 4) + 'px';
    }
</script>
</body>
</html>
