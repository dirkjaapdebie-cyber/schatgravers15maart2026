<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schatgravers - Het Avontuur</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4834d4; --accent: #eb4d4b; --success: #2ecc71;
            --white: rgba(255, 255, 255, 0.98); --gold: #fbc531;
            --night: #130f40;
        }

        body, html { margin: 0; padding: 0; height: 100vh; font-family: 'Fredoka', sans-serif; overflow: hidden; background: var(--night); color: #2d3436; }
        
        /* Dynamische Achtergrond */
        .bg-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(19, 15, 64, 0.8), rgba(19, 15, 64, 0.6)), url('schatgravers15maart.jpg');
            background-size: cover; background-position: center; z-index: -2;
        }

        /* Tijdlijn als een Pad */
        .path-nav {
            position: fixed; top: 25px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 60px; z-index: 100; align-items: center;
        }
        .step { width: 18px; height: 18px; background: rgba(255,255,255,0.3); border-radius: 50%; position: relative; transition: 0.4s; }
        .step.active { background: var(--gold); box-shadow: 0 0 20px var(--gold); transform: scale(1.4); }
        .step::after { content: ''; position: absolute; left: 25px; top: 8px; width: 45px; height: 2px; background: rgba(255,255,255,0.1); }
        .step:last-child::after { display: none; }

        .container { display: none; height: 100vh; padding: 100px 30px 30px; box-sizing: border-box; }

        /* FASE 3: KLUIS KAARTEN */
        .game-board { display: grid; grid-template-columns: 280px 1fr; gap: 25px; height: 100%; }
        .vault-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        
        .vault-card { 
            background: var(--white); border-radius: 25px; padding: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); position: relative;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border-bottom: 6px solid #dfe6e9; overflow: hidden;
        }
        .vault-card.active-vault { 
            transform: scale(1.03); border-color: var(--gold); 
            box-shadow: 0 15px 35px rgba(251, 197, 49, 0.4); 
            animation: breathe 2s infinite ease-in-out;
        }
        .vault-badge { position: absolute; top: -10px; right: 20px; background: var(--gold); color: white; padding: 5px 15px; border-radius: 15px; font-weight: bold; font-size: 1.2rem; }
        .vault-content { height: 140px; overflow-y: auto; margin-top: 15px; }

        /* BIJBEL STORY PERKAMENT */
        #story-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2000; display: none;
            justify-content: center; align-items: center; padding: 40px;
        }
        .scroll-content { 
            background: #fdf2e9; width: 100%; max-width: 800px; padding: 50px; 
            border-radius: 10px; border-left: 15px solid #d35400; border-right: 15px solid #d35400;
            box-shadow: 0 0 50px rgba(0,0,0,0.5); position: relative;
            max-height: 80vh; overflow-y: auto;
        }

        /* DOBBELSTEEN SPEELS */
        .dice-box { background: var(--white); border-radius: 30px; padding: 25px; text-align: center; box-shadow: 0 15px 30px rgba(0,0,0,0.3); }
        .cube { width: 70px; height: 70px; margin: 20px auto; transform-style: preserve-3d; transition: 1.2s; }
        .face { position: absolute; width: 70px; height: 70px; background: white; border: 3px solid var(--primary); line-height: 70px; font-size: 30px; font-weight: bold; border-radius: 12px; color: var(--primary); box-shadow: inset 0 0 10px rgba(0,0,0,0.05); }

        /* KNOPPEN */
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 25px; border-radius: 20px; font-family: 'Fredoka'; font-weight: 600; cursor: pointer; transition: 0.3s; width: 100%; font-size: 1rem; }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(72, 52, 212, 0.4); }

        /* REGIE */
        .admin-bar { position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 3000; background: rgba(255,255,255,0.1); padding: 10px; border-radius: 40px; backdrop-filter: blur(10px); }
        .adm-btn { width: 45px; height: 45px; border-radius: 50%; border: 2px solid white; background: none; color: white; font-weight: bold; cursor: pointer; }
        .adm-btn.active { background: white; color: var(--night); }

        .pill { background: #f1f2f6; padding: 8px 12px; border-radius: 12px; margin-bottom: 8px; font-size: 0.9rem; line-height: 1.3; animation: popIn 0.3s ease; }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes breathe { 0%, 100% { transform: scale(1.03); } 50% { transform: scale(1.05); } }
    </style>
</head>
<body>

<audio id="ping-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"></audio>
<div class="bg-overlay"></div>

<div class="path-nav">
    <div class="step" id="dot-p1"></div>
    <div class="step" id="dot-p2"></div>
    <div class="step" id="dot-p3"></div>
</div>

<div id="phase-1" class="container" style="display:flex; justify-content:center; align-items:center;">
    <div class="dice-box" style="max-width:400px; padding: 40px;">
        <h2 style="margin-top:0; color:var(--primary);">Hoi Schatgraver! üëã</h2>
        <p>Klaar om de reis naar de Olijfberg te maken? Typ je naam:</p>
        <input type="text" id="name-in" placeholder="Jouw naam..." style="width:100%; padding:15px; border-radius:15px; border:2px solid #eee; margin-bottom:15px; font-family:'Fredoka'; box-sizing:border-box;">
        <button onclick="sendName()" class="btn-main">IK REIS MEE!</button>
    </div>
</div>

<div id="phase-2" class="container" style="display:flex; justify-content:center; align-items:center;">
    <div class="dice-box" style="width: 500px;">
        <h1 id="timer-display" style="font-size:4rem; margin:0; color:var(--accent);">01:30</h1>
        <p style="font-size: 1.2rem;">Snel! De Olijfberg wacht...</p>
        <a href="https://earth.google.com/web/search/Mount+of+Olives,+Jerusalem" target="_blank" class="btn-main" style="text-decoration:none; display:block; padding:20px;">START JE REIS üåç</a>
    </div>
</div>

<div id="phase-3" class="container">
    <div class="game-board">
        <div class="sidebar">
            <div class="dice-box">
                <div class="cube" id="cube">
                    <div class="face" style="transform:rotateY(0deg) translateZ(35px)">1</div>
                    <div class="face" style="transform:rotateY(180deg) translateZ(35px)">2</div>
                    <div class="face" style="transform:rotateY(-90deg) translateZ(35px)">3</div>
                    <div class="face" style="transform:rotateY(90deg) translateZ(35px)">4</div>
                    <div class="face" style="transform:rotateX(-90deg) translateZ(35px)">5</div>
                    <div class="face" style="transform:rotateX(90deg) translateZ(35px)">6</div>
                </div>
                <button onclick="triggerRoll()" class="btn-main" style="margin-top:15px;">GOOI üé≤</button>
                <p id="active-stmt" style="font-weight:600; font-size:0.9rem; margin-top:15px; color:var(--primary); min-height:45px;"></p>
            </div>
            <div class="dice-box" style="margin-top:20px;">
                <input type="text" id="thought-in" placeholder="Typ hier..." style="width:100%; padding:12px; border-radius:12px; border:2px solid #eee; box-sizing:border-box;">
                <button onclick="sendThought()" class="btn-main" style="margin-top:10px; background:var(--success);">DEEL ‚ú®</button>
            </div>
        </div>

        <div class="vault-grid">
            <div class="vault-card" id="vault-1"><div class="vault-badge">1</div><h3 style="margin:0; font-size:0.9rem; color:#636e72;">ANGST</h3><div class="vault-content"></div></div>
            <div class="vault-card" id="vault-2"><div class="vault-badge">2</div><h3 style="margin:0; font-size:0.9rem; color:#636e72;">KEUZES</h3><div class="vault-content"></div></div>
            <div class="vault-card" id="vault-3"><div class="vault-badge">3</div><h3 style="margin:0; font-size:0.9rem; color:#636e72;">ENGELEN</h3><div class="vault-content"></div></div>
            <div class="vault-card" id="vault-4"><div class="vault-badge">4</div><h3 style="margin:0; font-size:0.9rem; color:#636e72;">BIDDEN</h3><div class="vault-content"></div></div>
            <div class="vault-card" id="vault-5"><div class="vault-badge">5</div><h3 style="margin:0; font-size:0.9rem; color:#636e72;">ALLEEN</h3><div class="vault-content"></div></div>
            <div class="vault-card" id="vault-6"><div class="vault-badge">6</div><h3 style="margin:0; font-size:0.9rem; color:#636e72;">HERSTEL</h3><div class="vault-content"></div></div>
        </div>
    </div>
</div>

<div id="story-overlay">
    <div class="scroll-content">
        <h2 style="color:#d35400; font-size:2rem; margin-top:0;">üìñ Het Verhaal</h2>
        <div style="font-size:1.2rem; color:#2d3436; text-align:left;">
            <p>Het was nacht op de Olijfberg. Jezus wist dat er een moeilijke tijd zou komen. Hij vroeg zijn vrienden om samen te bidden, maar ze waren z√≥ moe dat ze in slaap vielen.</p>
            <p>Jezus was alleen en bang, maar Hij gaf niet op. Hij bad tot God. Opeens kwam er een engel uit de hemel om Hem kracht te geven. Zo was Jezus toch niet alleen!</p>
        </div>
        <img src="schatgravers15maart.jpg" style="width:100%; border-radius:15px; margin-top:20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
    </div>
</div>

<div class="admin-bar">
    <button class="adm-btn" id="r1" onclick="updatePhase('p1')">1</button>
    <button class="adm-btn" id="r2" onclick="updatePhase('p2')">2</button>
    <button class="adm-btn" id="r3" onclick="updatePhase('p3')">3</button>
    <button class="adm-btn" id="rStory" onclick="toggleStory()" style="background:var(--accent); border:none;">üìñ</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBC3Dzm8PNPXw12VJNimvly5u2I93QeW54",
        authDomain: "schatgravers15maart2026.firebaseapp.com",
        projectId: "schatgravers15maart2026",
        databaseURL: "https://schatgravers15maart2026-default-rtdb.europe-west1.firebasedatabase.app",
        appId: "1:30561512857:web:fcb7868b87d292d1c97708"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    let timerInterval, currentDiceResult = 1, storyOpen = false;

    const stellingen = [
        "ANGST: Wanneer ben jij wel eens bang?", "KEUZES: Doe jij het goede als niemand kijkt?",
        "ENGELEN: Wie hielp jou op een moeilijk moment?", "BIDDEN: Hoe praat jij met God?",
        "ALLEEN: Voel jij je wel eens alleen?", "HERSTEL: Hoe maak jij iets weer goed?"
    ];

    window.updatePhase = (p) => set(ref(db, 'currentPhase'), p);
    window.toggleStory = () => { storyOpen = !storyOpen; set(ref(db, 'storyVisible'), storyOpen); };
    window.sendName = () => { const v = document.getElementById('name-in').value; if(v) push(ref(db, 'names'), v); };
    window.triggerRoll = () => set(ref(db, 'gameState'), {r: Math.floor(Math.random()*6)+1, t: Date.now()});
    window.sendThought = () => { 
        const v = document.getElementById('thought-in').value; 
        if(v) { push(ref(db, 'vaults/' + currentDiceResult), v); document.getElementById('thought-in').value=''; }
    };

    onValue(ref(db, 'currentPhase'), s => {
        const p = s.val() || 'p1';
        document.querySelectorAll('.container').forEach(c => c.style.display = 'none');
        document.getElementById('phase-' + p.replace('p','')).style.display = 'flex';
        document.querySelectorAll('.step, .adm-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('dot-' + p).classList.add('active');
        document.getElementById('r' + p.replace('p','')).classList.add('active');
        if (p === 'p2') startTimer(); else clearInterval(timerInterval);
    });

    onValue(ref(db, 'storyVisible'), s => {
        const visible = s.val();
        document.getElementById('story-overlay').style.display = visible ? 'flex' : 'none';
        document.getElementById('rStory').classList.toggle('active', visible);
        storyOpen = visible;
    });

    onValue(ref(db, 'gameState'), s => {
        const d = s.val(); if(d) {
            currentDiceResult = d.r;
            const rotations = {1:'rotateY(0deg)', 2:'rotateY(180deg)', 3:'rotateY(-90deg)', 4:'rotateY(90deg)', 5:'rotateX(-90deg)', 6:'rotateX(90deg)'};
            document.getElementById('cube').style.transform = rotations[d.r];
            document.getElementById('active-stmt').innerText = stellingen[d.r-1];
            document.querySelectorAll('.vault-card').forEach(v => v.classList.remove('active-vault'));
            document.getElementById('vault-' + d.r).classList.add('active-vault');
        }
    });

    onValue(ref(db, 'vaults'), s => {
        const data = s.val(); 
        for(let i=1; i<=6; i++) {
            const vContent = document.querySelector(`#vault-${i} .vault-content`);
            vContent.innerHTML = "";
            if(data && data[i]) Object.values(data[i]).forEach(t => {
                vContent.innerHTML += `<div class="pill">${t}</div>`;
            });
            vContent.scrollTop = vContent.scrollHeight;
        }
    });

    function startTimer() {
        let time = 90;
        timerInterval = setInterval(() => {
            let m = Math.floor(time/60), s = time%60;
            document.getElementById('timer-display').innerText = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(time <= 0) { clearInterval(timerInterval); document.getElementById('ping-sound').play(); }
            time--;
        }, 1000);
    }
</script>
</body>
</html>
